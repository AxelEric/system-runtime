/*
 * Runtime v1.2.1
 * The JSON Runtime Environment
 * https://system-runtime.github.io
 * @ecarriou
 *  
 * Copyright (c) 2016 Erwan Carriou
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE. 
 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.runtime=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d={models:{"19fe71f8af13886":{_id:"19fe71f8af13886",_name:"Worker",_schema:"Worker",_inherit:["RuntimeComponent"],_core:!0,worker:{type:"object",readOnly:!1,mandatory:!1,"default":{}},send:{params:[{name:"message",type:"object"}]}},"138a81fa1f16435":{_id:"138a81fa1f16435",_name:"RuntimeAdmin",_schema:"RuntimeAdmin",_inherit:["RuntimeComponent"],_core:!0,start:{params:[{name:"path",type:"string",mandatory:!1,"default":""}]},stop:{}},"135c71078810af2":{_id:"135c71078810af2",_name:"RuntimeChannel",_schema:"RuntimeChannel",_inherit:["RuntimeComponent"],sync:{},loadSystem:{params:[{name:"system",type:"object"}]},createSchema:{params:[{name:"id",type:"string"},{name:"schema",type:"object"}]},updateSchema:{params:[{name:"id",type:"string"},{name:"schema",type:"object"}]},deleteSchema:{params:[{name:"id",type:"string"}]},createModel:{params:[{name:"id",type:"string"},{name:"model",type:"object"}]},updateModel:{params:[{name:"id",type:"string"},{name:"model",type:"object"}]},deleteModel:{params:[{name:"id",type:"string"}]},createType:{params:[{name:"id",type:"string"},{name:"type",type:"object"}]},updateType:{params:[{name:"id",type:"string"},{name:"type",type:"object"}]},deleteType:{params:[{name:"id",type:"string"}]},createComponent:{params:[{name:"collection",type:"string"},{name:"component",type:"object"}]},updateComponent:{params:[{name:"id",type:"string"},{name:"collection",type:"string"},{name:"component",type:"object"}]},deleteComponent:{params:[{name:"id",type:"string"},{name:"collection",type:"string"}]},createBehavior:{params:[{name:"behavior",type:"object"}]},updateBehavior:{params:[{name:"id",type:"string"},{name:"behavior",type:"object"}]},deleteBehavior:{params:[{name:"id",type:"string"}]},_core:!0,send:{params:[{name:"message",type:"object"}]}},"14c7c105b31a160":{_id:"14c7c105b31a160",_name:"Runtime",load:{params:[{name:"url",type:"string"},{name:"async",type:"boolean",mandatory:!1,"default":!0}]},ready:{},_core:!0,version:{type:"string",readOnly:!0,mandatory:!0,"default":"0.0.0"},warning:{params:[{name:"message",type:"string"}]},system:{params:[{name:"name",type:"string",mandatory:!1}],result:"object"}},"19363180731cbf6":{_name:"RuntimeBehavior",_core:!0,core:{type:"boolean",readOnly:!1,mandatory:!1,"default":!1},useCoreAPI:{type:"boolean",readOnly:!1,mandatory:!1,"default":!1},component:{type:"string",readOnly:!1,mandatory:!0,"default":""},action:{type:"javascript",readOnly:!1,mandatory:!0,"default":""},state:{type:"string",readOnly:!1,mandatory:!0,"default":""},_id:"19363180731cbf6"},"10b0a1b26916227":{_name:"RuntimeClassInfo",_core:!0,metamodel:{type:"object",readOnly:!0,mandatory:!0,"default":{}},model:{type:"object",readOnly:!0,mandatory:!0,"default":{}},property:{params:[{name:"name",type:"string"}],result:"object"},properties:{result:"array"},link:{params:[{name:"name",type:"string"}],result:"object"},links:{result:"array"},method:{params:[{name:"name",type:"string"}],result:"object"},methods:{result:"array"},collection:{params:[{name:"name",type:"string"}],result:"object"},collections:{result:"array"},event:{params:[{name:"name",type:"string"}],result:"object"},events:{result:"array"},_id:"10b0a1b26916227"},"107d714363108b2":{_name:"RuntimeComponent",_core:!0,on:{params:[{name:"state",type:"string"},{name:"handler",type:"function"},{name:"useCoreAPI",type:"boolean",mandatory:!1}]},off:{params:[{name:"state",type:"string",mandatory:!1},{name:"behaviorId",type:"string",mandatory:!1}]},require:{params:[{name:"id",type:"string"}]},destroy:{params:[]},classInfo:{type:"@RuntimeClassInfo",readOnly:!1,mandatory:!1,"default":{}},init:{params:[{name:"conf",type:"object"}]},error:{params:[{name:"data",type:"errorParam"}]},_id:"107d714363108b2"},"17b06182f813868":{_name:"RuntimeDatabase",_core:!0,system:{params:[{name:"system",type:"object",mandatory:!1}],result:"string"},subsystem:{params:[{name:"params",type:"object"}],result:"string"},collections:{result:"object"},insert:{params:[{name:"classId",type:"string"},{name:"object",type:"object"}]},update:{params:[{name:"schema",type:"string"},{name:"componentId",type:"string"},{name:"attributeName",type:"string"},{name:"attributeValue",type:"object"}]},remove:{params:[{name:"classId",type:"string"},{name:"object",type:"string"}]},_id:"17b06182f813868"},"1d0b810e941f504":{_name:"RuntimeMessage",_core:!0,event:{type:"string",readOnly:!1,mandatory:!0,"default":""},from:{type:"string",readOnly:!1,mandatory:!0,"default":""},data:{type:"array",readOnly:!1,mandatory:!0,"default":[]},_id:"1d0b810e941f504"},"163ba1f95413587":{_name:"RuntimeMetamodel",_core:!0,schema:{params:[{name:"schema",type:"object"}],result:"any"},model:{params:[{name:"model",type:"object"}],result:"any"},type:{params:[{name:"type",type:"object"}],result:"any"},create:{params:[]},_id:"163ba1f95413587"},"12e9a130e61f3a6":{_name:"RuntimeState",_core:!0,name:{type:"string",readOnly:!1,mandatory:!0,"default":""},parameters:{type:"object",readOnly:!1,mandatory:!1,"default":{}},_id:"12e9a130e61f3a6"},"122c719e8a1e4dd":{_name:"RuntimeSystem",_core:!0,name:{type:"string",readOnly:!1,mandatory:!0,"default":""},master:{type:"boolean",readOnly:!1,mandatory:!1,"default":!1},subsystem:{type:"boolean",readOnly:!1,mandatory:!1,"default":!1},version:{type:"string",readOnly:!1,mandatory:!1,"default":"0.0.1"},description:{type:"string",readOnly:!1,mandatory:!1,"default":""},schemas:{type:"object",readOnly:!1,mandatory:!1,"default":{}},models:{type:"object",readOnly:!1,mandatory:!1,"default":{}},behaviors:{type:"object",readOnly:!1,mandatory:!1,"default":{}},types:{type:"object",readOnly:!1,mandatory:!1,"default":{}},components:{type:"object",readOnly:!1,mandatory:!1,"default":{}},ready:{},sync:{},main:{},_id:"122c719e8a1e4dd"}},schemas:{"155ab18d911ad9f":{_id:"155ab18d911ad9f",_name:"Worker",_inherit:["RuntimeComponent"],_core:!0,worker:"property",send:"method"},"10374180581a41f":{_id:"10374180581a41f",_name:"RuntimeAdmin",_inherit:["RuntimeComponent"],_core:!0,start:"method",stop:"method"},"104ad1f48518376":{_id:"104ad1f48518376",_name:"RuntimeChannel",sync:"event",loadSystem:"event",createSchema:"event",updateSchema:"event",deleteSchema:"event",createModel:"event",updateModel:"event",deleteModel:"event",createType:"event",updateType:"event",deleteType:"event",createComponent:"event",updateComponent:"event",deleteComponent:"event",createBehavior:"event",updateBehavior:"event",deleteBehavior:"event",_inherit:["RuntimeComponent"],_core:!0,send:"event"},"12e211d4cd120a6":{_id:"12e211d4cd120a6",_name:"Runtime",load:"method",ready:"event",_inherit:["RuntimeComponent"],_core:!0,version:"property",system:"method",warning:"event"},"1cd60187d81a750":{_name:"RuntimeBehavior",_inherit:["RuntimeComponent"],_core:!0,core:"property",component:"property",action:"property",state:"property",useCoreAPI:"property",_id:"1cd60187d81a750"},"1e9bf1d8191f10c":{_name:"RuntimeClassInfo",_inherit:["RuntimeComponent"],_core:!0,model:"property",metamodel:"property",method:"method",methods:"method",property:"method",properties:"method",link:"method",links:"method",collections:"method",collection:"method",event:"method",events:"method",_id:"1e9bf1d8191f10c"},"1169b15aeb15932":{_name:"RuntimeComponent",_inherit:[],_core:!0,classInfo:"property",on:"method",off:"method",require:"method",destroy:"method",init:"method",error:"event",_id:"1169b15aeb15932"},"1187f1591c1f8c5":{_name:"RuntimeDatabase",_inherit:["RuntimeComponent"],_core:!0,system:"method",subsystem:"method",collections:"method",insert:"event",update:"event",remove:"event",_id:"1187f1591c1f8c5"},"1db291a60e16a4f":{_name:"RuntimeMessage",_inherit:[],_core:!0,event:"property",from:"property",data:"property",_id:"1db291a60e16a4f"},"175a11ae6d1e132":{_name:"RuntimeMetamodel",_inherit:["RuntimeComponent"],_core:!0,schema:"method",model:"method",type:"method",create:"method",_id:"175a11ae6d1e132"},"19f78193841a697":{_name:"RuntimeState",_inherit:[],_core:!0,_class:!1,name:"property",parameters:"property",_id:"19f78193841a697"},"107771ecf715e2f":{_name:"RuntimeSystem",_inherit:["RuntimeComponent"],_core:!0,name:"property",master:"property",subsystem:"property",version:"property",description:"property",schemas:"property",models:"property",behaviors:"property",types:"property",components:"property",sync:"method",main:"method",ready:"event",_id:"107771ecf715e2f"}},types:{html:{name:"html",type:"string",core:!0},css:{name:"css",type:"string",core:!0},collection:{name:"collection",type:"object",schema:{type:{type:["string"],mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},"default":{type:"object",mandatory:!0},description:{type:"string",mandatory:!1}},core:!0},errorParam:{name:"errorParam",type:"object",schema:{message:{type:"string",mandatory:!0},error:{type:"object",mandatory:!0}},core:!0},event:{name:"event",type:"object",schema:{params:{type:["parameter"],mandatory:!1},description:{type:"string",mandatory:!1}},core:!0},javascript:{name:"javascript",type:"string",core:!0},json:{name:"json",type:"string",core:!0},link:{name:"link",type:"object",schema:{type:{type:"string",mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},"default":{type:"@type",mandatory:!0},description:{type:"string",mandatory:!1}},core:!0},message:{name:"message",type:"object",schema:{event:{type:"string",mandatory:!0},from:{type:"string",mandatory:!1},data:{type:"object",mandatory:!0}},core:!0},method:{name:"method",type:"object",schema:{result:{type:"string",mandatory:!1},params:{type:["parameter"],mandatory:!1},description:{type:"string",mandatory:!1}},core:!0},parameter:{name:"parameter",type:"object",schema:{name:{type:"string",mandatory:!0},type:{type:"string",mandatory:!0},mandatory:{type:"boolean",mandatory:!1},"default":{type:"@type",mandatory:!1}},core:!0},property:{name:"property",type:"object",schema:{type:{type:"string",mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},"default":{type:"@type",mandatory:!0},description:{type:"string",mandatory:!1}},core:!0}},behaviors:{"1c00c107e01c9b3":{_id:"1c00c107e01c9b3",component:"RuntimeAdmin",state:"start",action:"function start(path) {\n    var Worker = null,\n    worker = null,\n    workerPath = '',\n    RuntimeChannel = null,\n    runtimeChannel = null;\n    \n    if (path) {\n        workerPath = path + '/scripts/worker.js';\n        workerPath = workerPath.replace(/\\/\\//g,'/');\n    } else {\n        workerPath = '/designer/scripts/worker.js';\n    }\n    \n    if (typeof SharedWorker !== 'undefined') {\n        \n        if (!this.require('channel-admin')) {\n            RuntimeChannel = this.require('RuntimeChannel');\n            runtimeChannel = new RuntimeChannel({\n                '_id': 'channel-admin',\n                '_core': true\n            });\n            \n            runtimeChannel.on('send', function send(message) {\n                this.require('worker-admin').worker().port.postMessage(message);\n            });\n            \n            // schema change events\n            runtimeChannel.on('createSchema', function createSchema(id, schema) {\n                this.require('metamodel').schema(schema);\n                this.require('metamodel').create();\n            }, true);\n            \n            runtimeChannel.on('updateSchema', function updateSchema(id, schema) {\n                 this.require('metamodel').type(schema);\n                 this.require('metamodel').create();\n            }, true);\n            \n            runtimeChannel.on('deleteSchema', function deleteSchema(id) {\n                $db['Runtime'].remove({'_id': id});\n                this.require('metamodel').create();\n            }, true);\n            \n            // model change events\n            runtimeChannel.on('createModel', function createModel(id, model) {\n                this.require('metamodel').schema(model);\n                this.require('metamodel').create();\n            }, true);\n            \n            runtimeChannel.on('updateModel', function updateModel(id, model) {\n                 this.require('metamodel').type(model);\n                 this.require('metamodel').create();\n            }, true);\n            \n            runtimeChannel.on('deleteModel', function deleteModel(id) {\n                $db['Runtime'].remove({'_id': id});\n                this.require('metamodel').create();\n                $component.removeFromMemory(id);\n            }, true);\n            \n            // type change events\n            runtimeChannel.on('createType', function createType(id, type) {\n                this.require('metamodel').type(type);\n                this.require('metamodel').create();\n            }, true);\n            \n            runtimeChannel.on('updateType', function updateType(id, type) {\n                 this.require('metamodel').type(type);\n                 this.require('metamodel').create();\n            }, true);\n            \n            runtimeChannel.on('deleteType', function deleteType(id) {\n                $db['RuntimeType'].remove({'_id': id});\n                this.require('metamodel').create();\n            }, true);\n            \n            // component change events\n            runtimeChannel.on('createComponent', function createComponent(model, component) {\n                $db[model].insert(component);\n            }, true);\n            \n            runtimeChannel.on('updateComponent', function updateComponent(id, collection, component) {\n                $db[collection].update({'_id': id}, component);\n            }, true);\n            \n            runtimeChannel.on('deleteComponent', function deleteComponent(id, collection) {\n                $db[collection].remove({'_id': id});\n            }, true);\n            \n            // behavior change events\n            runtimeChannel.on('createBehavior', function createBehavior(component) {\n                $db['RuntimeBehavior'].insert(component);\n            }, true);\n            runtimeChannel.on('updateBehavior', function updateBehavior(id, behavior) {\n                this.require(id).action(behavior.action);\n            });\n            runtimeChannel.on('deleteBehavior', function deleteBehavior(id) {\n                $db['RuntimeBehavior'].remove({'_id': id});                  \n            }, true);\n         \n            // System Designer event\n            runtimeChannel.on('sync', function sync() {\n                this.loadSystem(JSON.parse(this.require('db').system()));\n            });\n    \n            Worker = this.require('Worker');\n            worker = new Worker({\n                '_id': 'worker-admin',\n                '_core': true,\n                'worker': new SharedWorker(workerPath),\n            });\n            \n            worker.worker().port.onmessage = function (e) {\n              $db.RuntimeMessage.insert(e.data);\n            };\n            \n            console.info('runtime: admin is started');\n        } else {\n            console.info('runtime: admin is already started');\n        }\n    } else {\n        console.info('runtime: the browser can not run admin features');\n    }\n}",useCoreAPI:!0,core:!0},"1d7151dd2d1558f":{_id:"1d7151dd2d1558f",component:"RuntimeAdmin",state:"stop",action:"function stop() {\n    var worker = null,\n    channel = null;\n    \n    worker = this.require('worker-admin');\n    if (worker && worker.worker()) {\n        worker.worker().port.onmessage = function () {};\n        worker.destroy();\n        \n        channel = this.require('channel-admin');\n        if (channel) {\n            channel.destroy();\n        }\n        \n        console.info('runtime: admin is stopped');\n    }\n}",useCoreAPI:!0,core:!0},"1fc101c23918773":{component:"RuntimeComponent",state:"off",action:'function off(state, behaviorId) {\n    var args = [],\n    i = 0,\n    length = 0;\n    length = arguments.length;\n    \n    for (i = 0; i < length - 6; i++) {\n        args.push(arguments[i]);\n    }\n    \n    if ($workflow.checkParams({\n        "component": this, \n        "methodName": "off", \n        "args": args\n        })) {\n        \n        if (state || behaviorId) {\n            if ($metamodel.isValidState(state, this.constructor.name)) {\n                $behavior.remove({\n                    "behaviorId": behaviorId, \n                    "componentId": this.id(), \n                    "state": state\n                });\n            } else { \n                console.warn("runtime: invoke \\\'off\\\' method of component \'" + this.id() + "\' with an invalid state \'" + state + "\'"); \n            }\n        } else {\n            $behavior.remove({\n                "componentId": this.id()\n            });\n        }\n    }\n}',core:!0,useCoreAPI:!0},"1aaee1e6311ff39":{_id:"1aaee1e6311ff39",component:"runtime",state:"load",action:"function load(url, async) {\n    var xhr = null,\n    callbackLoad = null;\n    xhr = new XMLHttpRequest();\n    \n    callbackLoad = function callbackLoad(system) {\n        var sysId = $db.system(system),\n        sys = $component.get(sysId),\n        systems = document.querySelectorAll('link[rel=system]'),\n        nbSubsystem = $db.RuntimeSystem.find({\n            'subsystem': true\n        }); \n        if (sys) {\n            sys.main();\n        } \n        if (systems.length + 1 + nbSubsystem.length === $db.RuntimeSystem.count()) {\n            $component.get('runtime').ready();\n        }\n    };\n    \n    if (async) {\n        xhr.open('GET', url, true);\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    callbackLoad(JSON.parse(xhr.response));\n                }\n            }\n        };\n        xhr.send(null);\n    } else {\n        xhr.open('GET', url, false);\n        xhr.send(null);\n        if (xhr.status === 200) {\n            callbackLoad(JSON.parse(xhr.response));\n        }\n    }\n}",core:!0,useCoreAPI:!0},"1f6001773a18791":{_id:"1f6001773a18791",component:"e89c617b6b15d24",state:"main",action:"function main() {\n    var subsystems = [],\n    systems = [],\n    system = null,\n    scripts = [],\n    script = null,\n    pathToDesigner = '',\n    i = 0,\n    length = 0;\n    \n    subsystems = $db.RuntimeSystem.find({\n        'subsystem': true\n    });\n    subsystems.forEach(function (subsystem) {\n        var subsystemId = subsystem._id;\n        this.require(subsystemId).main();\n    }, this); \n    \n    if (typeof document !== 'undefined') {\n        systems = document.querySelectorAll('link[rel=system]');\n        length = systems.length;\n        \n        // systems\n        for (i = 0; i < length; i++) {\n            system = systems[i];\n            \n            if (system.getAttribute('async') === 'false') {\n                this.require('runtime').load(system.href, false);\n            } else {\n                this.require('runtime').load(system.href, true);\n            }\n        }\n        if (length === 0) {\n           this.require('runtime').ready();\n        }\n        \n        // admin\n        scripts = document.querySelectorAll('script[designer]');\n        if (scripts.length) {\n            pathToDesigner = scripts[0].getAttribute('designer');\n            this.require('admin').start(pathToDesigner);\n        }\n    }\n}",core:!0,useCoreAPI:!0},"19d33182701d75f":{_id:"19d33182701d75f",component:"Runtime",state:"error",action:"function error(data) {\n    console.error('runtime: ' + data.message, data.error);\n}",core:!0},"1a8b41f09811fb9":{_id:"1a8b41f09811fb9",component:"Runtime",state:"system",action:"function system(name) {\n    var System = null,\n    system = {},\n    systemId = '',\n    result = [],\n    conf = {};\n    \n    if (name) {\n        conf.master = true;\n        conf.name = name;\n        System = this.require('RuntimeSystem');\n        system = new System(conf);\n    } else {\n        result = $db.RuntimeSystem.find({\n            'master': true\n        });\n        if (result.length) {\n            systemId = result[0]._id;\n            system = $component.get(systemId);\n        }\n    }\n    return system;\n}",core:!0,useCoreAPI:!0},"179af12bec188e2":{_id:"179af12bec188e2",component:"Runtime",state:"warning",action:"function warning(message) {\n    console.warn('runtime: ' + message);\n}",core:!0},"1a93113eb61e4c0":{_id:"1a93113eb61e4c0",component:"RuntimeClassInfo",state:"collection",action:"function collection(name) {\n    var result = {};\n    if (this.metamodel()[name] === 'collection') {\n        result = this.model()[name];\n    } \n    \n    return result; \n}",core:!0},"1dbc012b6e1f9b9":{_id:"1dbc012b6e1f9b9",component:"RuntimeClassInfo",state:"collections",action:"function collections() {\n    var keys = Object.keys(this.metamodel()),\n    item = '',\n    result = [],\n    i = 0,\n    length = 0;\n    \n    length = keys.length; \n    \n    for (i = 0; i < length; i++) { \n        item = keys[i]; \n        if (this.metamodel()[item] === 'collection') {\n            result.push(item);\n        }\n    }\n    \n    return result;\n}",core:!0},"1ef701c6d316289":{_id:"1ef701c6d316289",component:"RuntimeClassInfo",state:"event",action:"function event(name) {\n    var result = {};\n    \n    if (this.metamodel()[name] === 'event') {\n        result = this.model()[name];\n    } \n    \n    return result;\n}",core:!0},"103911496a18887":{_id:"103911496a18887",component:"RuntimeClassInfo",state:"events",action:"function events() {\n    var keys = Object.keys(this.metamodel()),\n    item = '',\n    result = [],\n    i = 0,\n    length = 0;\n    \n    length = keys.length;\n    \n    for (i = 0; i < length; i++) {\n        item = keys[i];\n        if (this.metamodel()[item] === 'event') {\n            result.push(item);\n        }\n    } \n    return result;\n}",core:!0},"1a8341a3e71c588":{_id:"1a8341a3e71c588",component:"RuntimeClassInfo",state:"link",action:"function link(name) {\n    var result = {};\n    \n    if (this.metamodel()[name] === 'link') {\n        result = this.model()[name];\n    }\n    return result;\n}",core:!0},"13d871905a1b399":{_id:"13d871905a1b399",component:"RuntimeClassInfo",state:"links",action:"function links() { \n    var keys = Object.keys(this.metamodel()),\n    item = '',\n    result = [],\n    i = 0,\n    length = 0;\n    length = keys.length;\n    \n    for (i = 0; i < length; i++) {\n        item = keys[i];\n        if (this.metamodel()[item] === 'link') {\n            result.push(item);\n        }\n    } return result;\n}",core:!0},"129741b94116b55":{_id:"129741b94116b55",component:"RuntimeClassInfo",state:"method",action:"function method(name) {\n    var result = {};\n    if (this.metamodel()[name] === 'method') {\n        result = this.model()[name];\n        \n    }\n    \n    return result;\n}",core:!0},"18f7d1f33d159af":{_id:"18f7d1f33d159af",component:"RuntimeClassInfo",state:"methods",action:"function methods() {\n    var keys = Object.keys(this.metamodel()),\n    item = '',\n    result = [],\n    i = 0,\n    length = 0;\n    length = keys.length;\n    for (i = 0; i < length; i++) {\n        item = keys[i];\n        if (this.metamodel()[item] === 'method') {\n            result.push(item);\n        }\n    } \n    \n    return result;\n}",core:!0},"1a61d167221ca4f":{_id:"1a61d167221ca4f",component:"RuntimeClassInfo",state:"properties",action:"function properties() { \n    var keys = Object.keys(this.metamodel()),\n    item = '',\n    result = [],\n    i = 0,\n    length = 0;\n    length = keys.length;\n    \n    for (i = 0; i < length; i++) {\n        item = keys[i];\n        if (this.metamodel()[item] === 'property') {\n            result.push(item);\n        }\n    } return result;\n}",core:!0},"1a4511f876133e8":{_id:"1a4511f876133e8",component:"RuntimeClassInfo",state:"property",action:"function property(name) {\n    var result = {};\n    \n    if (this.metamodel()[name] === 'property') {\n        result = this.model()[name];\n    }\n    return result;\n}",core:!0},"1020b1f10211b6b":{_id:"1020b1f10211b6b",component:"RuntimeComponent",state:"destroy",action:"function destroy() {\n    $component.destroy(this.id());\n}",core:!0,useCoreAPI:!0},"14c4817e7b10fd6":{_id:"14c4817e7b10fd6",component:"RuntimeComponent",state:"off",action:'function off(state, behaviorId) {\n    var args = [],\n    i = 0,\n    length = 0;\n    length = arguments.length;\n    \n    for (i = 0; i < length - 6; i++) {\n        args.push(arguments[i]);\n    }\n    \n    if ($workflow.checkParams({\n        "component": this, \n        "methodName": "off", \n        "args": args\n        })) {\n        \n        if (state || behaviorId) {\n            if ($metamodel.isValidState(state, this.constructor.name)) {\n                $behavior.remove({\n                    "behaviorId": behaviorId, \n                    "componentId": this.id(), \n                    "state": state\n                });\n            } else { \n                console.warn("runtime: invoke \\\'off\\\' method of component \'" + this.id() + "\' with an invalid state \'" + state + "\'"); \n            }\n        } else {\n            $behavior.remove({\n                "componentId": this.id()\n            });\n        }\n    }\n}',core:!0,useCoreAPI:!0},"174c01aedb12438":{_id:"174c01aedb12438",component:"RuntimeComponent",state:"require",action:"function require(id) {\n    return $component.get(id);\n}",core:!0,useCoreAPI:!0},"1102b1be711bf00":{_id:"1102b1be711bf00",component:"RuntimeDatabase",state:"collections",action:"function collections() {\n    var result = {},\n    collectionName = '';\n    \n    for (collectionName in $db.store) {\n        if ($db.store.hasOwnProperty(collectionName) && collectionName.indexOf('Runtime') !== 0) {\n            result[collectionName] = $db[collectionName];\n            \n        }\n    }\n    return result;\n}",core:!0,useCoreAPI:!0},"146641cb8419e15":{_id:"146641cb8419e15",component:"RuntimeDatabase",state:"subsystem",action:"function subsystem(params) {\n    return $db.subsystem(params);\n}",core:!0,useCoreAPI:!0},"1e303188c716df6":{_id:"1e303188c716df6",component:"RuntimeDatabase",state:"system",action:"function system(system) {\n    return $db.system(system);\n}",core:!0,useCoreAPI:!0},"1a95511ec618baa":{_id:"1a95511ec618baa",component:"RuntimeMetamodel",state:"create",action:"function create() {\n    $metamodel.create();\n}",core:!0,useCoreAPI:!0},"18783132b61b37c":{_id:"18783132b61b37c",component:"RuntimeMetamodel",state:"model",action:"function model(model) {\n    return $metamodel.model(model);\n}",core:!0,useCoreAPI:!0},"1153b172bb17431":{_id:"1153b172bb17431",component:"RuntimeMetamodel",state:"schema",action:"function schema(schema) {\n    return $metamodel.schema(schema);\n}",core:!0,useCoreAPI:!0},"1729e193db189a2":{_id:"1729e193db189a2",component:"RuntimeMetamodel",state:"type",action:"function type(type) {\n    return $metamodel.type(type);\n}",core:!0,useCoreAPI:!0},"1984918b3b11f3f":{_id:"1984918b3b11f3f",component:"RuntimeSystem",state:"sync",action:"function sync() {\n    var system = JSON.parse($db.system());\n    \n    this.schemas(system.schemas);\n    this.types(system.types);\n    this.behaviors(system.behaviors);\n    this.components(system.components);\n}",core:!0,useCoreAPI:!0}},components:{RuntimeAdmin:{admin:{_id:"admin",_core:!0}},Runtime:{runtime:{_id:"runtime",version:"1.2.1"}},RuntimeDatabase:{db:{_id:"db"}},RuntimeMetamodel:{metamodel:{_id:"metamodel"}},RuntimeSystem:{"18ed81de331252c":{_id:"18ed81de331252c",name:"system-admin",version:"0.2.0",description:"Runtime Component administration ",subsystem:!0,master:!1},"133421d0c313d2d":{_id:"133421d0c313d2d",name:"web",version:"0.1.0",description:"Add behaviors for web",subsystem:!0,master:!1},"1f6ff194df1c37a":{_id:"1f6ff194df1c37a",name:"webType",version:"0.1.0",description:"Add types for web",subsystem:!0,master:!1}}},name:"runtime",version:"1.2.1",description:"Runtime",_id:"e89c617b6b15d24",master:!1,subsystem:!1};c.system=d},{}],2:[function(a,b,c){"use strict";function d(a,b,c,d){var e="",f=-1,g="",h=[],i=[],j="",k="",l=null;return f=b.indexOf("{"),k=b.substring(0,f),e=k.split("(")[0].replace("function","").trim(),g=k.split("(")[1].replace(")","").trim(),h=g.split(","),h.forEach(function(a){i.push(a.trim())}),j=b.substring(f+1),j=j.substring(0,j.lastIndexOf("}")).trim(),e=e||a,""===h[0]&&(h=[]),d&&(h.push("$component"),h.push("$db"),h.push("$metamodel"),h.push("$workflow"),h.push("$behavior"),h.push("$state")),l=""!==h[0]?new Function("body","return function "+e+" ("+h.join(",")+") { return new Function('"+h.join("','")+"', body).apply(this, arguments) };")(j):new Function("body","return function "+e+" () { return new Function(body).apply(this, arguments) };")(j)}function e(a,b,c,e,f){var g=l.generateId(),h=c.toString();return"undefined"==typeof f&&(f=!1),"undefined"==typeof e&&(e=!1),c=d(b,h,f,e),m[g]=c,k.RuntimeBehavior.insert({_id:g,component:a,state:b,action:h,useCoreAPI:e,core:f}),g}function f(a){var b=[];a=a||{},a.behaviorId=a.behaviorId||"",a.componentId=a.componentId||"",a.state=a.state||"",a.componentId&&(a.behaviorId?(k.RuntimeBehavior.remove({_id:a.behaviorId,component:a.componentId,state:a.state}),delete m[a.behaviorId]):(b=a.state?k.RuntimeBehavior.remove({component:a.componentId,state:a.state}):k.RuntimeBehavior.remove({component:a.componentId}),b.forEach(function(a){delete m[a]})))}function g(a){delete m[a]}function h(a,b){var c=[],e=[],f=null;return e=k.RuntimeBehavior.find({component:a,state:b}),e.forEach(function(a){f=m[a._id],"undefined"==typeof f&&(f=d(a.state,a.action,a.core,a.useCoreAPI),m[a._id]=f),c.push({useCoreAPI:a.useCoreAPI,action:f})}),c}function i(){m={}}function j(a){return m[a]}var k=a("./db.js"),l=a("./helper.js"),m={};c.add=e,c.get=j,c.remove=f,c.getActions=h,c.clear=i,c.removeFromMemory=g},{"./db.js":4,"./helper.js":5}],3:[function(a,b,c){"use strict";function d(a){var b=[],c=[],d="",e="",f="",g=!1;return a=a||{},d=a.type||"",e=a.id||"",f=a.propertyName||"",c=a.arr||[],"undefined"!=typeof a.readOnly&&(g=a.readOnly),c.forEach(function(a){-1!==d.indexOf("@")?b.push(C.getRuntime().require(a)):b.push(a)}),b.push=function(a){var b=!1;return g?D.readOnlyProperty(e,f):(b=-1!==d.indexOf("@"),b?a&&A.inheritFrom(a.constructor.name,d.replace("@",""))?(c.push(a.id()),y.state({component:e,state:f,data:[c.length,a.id(),"add"]})):D.invalidPropertyName(e,f,a.id(),d):a&&A.isValidType(a,d)?(c.push(a),y.state({component:e,state:f,data:[c.length,a,"add"]})):D.invalidPropertyName(e,f,a,d)),c.length},b.pop=function(){var a,b=null,h=!1;return g?D.readOnlyProperty(e,f):0!==c.length&&(b=c.pop(),y.state({component:e,state:f,data:[c.length,b,"remove"]}),h=-1!==d.indexOf("@"),a=h?L[b]:b),a},b}function e(a,b){var c=[],d=[],e=0,f=0;if(c=A.getModel(a)[b].params)for(e=c.length,f=0;e>f;f++)d.push(c[f].name);return d}function f(a){var b=null,c=null,d=[],e=0,f=0,g=[];for(b=A.getModel(a),c=A.getSchema(b._schema),d=Object.keys(c),e=d.length,f=0;e>f;f++)c[d[f]]!==H&&c[d[f]]!==G&&c[d[f]]!==I||g.push({name:d[f],type:b[d[f]].type,readOnly:b[d[f]].readOnly});return g}function g(a){var b=null,c=null,d=[],e=0,f=0,g=[];
for(b=A.getModel(a),c=A.getSchema(b._schema),d=Object.keys(c),e=d.length,f=0;e>f;f++)c[d[f]]===J&&g.push(d[f]);return g}function h(a){var b=null,c=null,d=[],e=0,f=0,g=[];for(b=A.getModel(a),c=A.getSchema(b._schema),d=Object.keys(c),e=d.length,f=0;e>f;f++)c[d[f]]===K&&g.push(d[f]);return g}function i(a){var b=function(b){b=b||{};var c={};"Object"!==b.constructor.name&&(D.invalidConctructorParameters(b,a),b={}),A.isValidObject(b,A.getModel(a),!0,!0)||D.invalidParameters(a),A.prepareObject(b,A.getModel(a)),"undefined"==typeof b._id&&(b._id=C.generateId()),L[b._id]=this,c=function(){return b._id},this.id=new Function("body","return function id () { return body.call(this) };")(c),b.classInfo=a+"Info",z.store[a][b._id]=b,C.isRuntime()&&C.getRuntime().require("db")&&C.getRuntime().require("db").insert(a,b),Object.freeze(this),this.init&&this.init(b)};return new Function("body","return function "+a+" (config) { body.call(this,config) };")(b)}function j(a,b){var c=function(){return b};a.id=new Function("body","return function id (prop, val) { return body.call(this, prop, val) };")(c)}function k(a,b,c){var e=f(a);e.forEach(function(a){var e={},f="",g="",h="";f=a.name,g=a.type,h=a.readOnly,Array.isArray(g)?(e=function(a,b){var e=[],i=null,j=null,k=null,l=null;if("undefined"==typeof b){if("undefined"==typeof a)return j=new d({id:this.id(),propertyName:f,readOnly:h,classId:c,type:g[0],arr:z.store[c][this.id()][f]});if(k=z.store[c][this.id()][f][a])return l=-1!==g[0].indexOf("@")?C.getRuntime().require(k):k}else h?D.readOnlyProperty(this.id(),f):(A.isValidType(b,g[0])||A.inheritFrom(b.constructor.name,g[0].replace("@",""))&&-1!==g[0].indexOf("@"))&&(e=z[c].find({_id:this.id()}),e.length?(l=-1!==g[0].indexOf("@")?b.id():b,i=e[0],i[f][a]=l,C.isRuntime()&&C.getRuntime().require("db").update(c,this.id(),f,l),y.state({component:this.id(),state:f,data:[a,l,"add"]})):D.invalidPropertyName(this.id(),f,b,g))},b.prototype[f]=new Function("body","return function "+f+" (position,value) { return body.call(this, position, value) };")(e)):(e=function(a){var b=[],d=null,e=null;if("undefined"==typeof a){if(d=z.store[c][this.id()])return e=d[f],-1!==g.indexOf("@")&&(e=t(e)),e;D.destroyedComponentCall(f,this.id())}else h?D.readOnlyProperty(this.id(),f):A.isValidType(a,g)?(b=z[c].find({_id:this.id()}),b.length&&(d=b[0],-1!==g.indexOf("@")?d[f]=a.id():d[f]=a,C.isRuntime()&&C.getRuntime().require("db")&&C.getRuntime().require("db").update(c,this.id(),f,a),"RuntimeBehavior"===c&&B.removeFromMemory(this.id()),y.state({component:this.id(),state:f,data:[a]}))):D.invalidPropertyName(this.id(),f,a,g)},b.prototype[f]=new Function("body","return function "+f+" (value) { return body.call(this,value) };")(e))})}function l(a,b,c){var d=g(a);d.forEach(function(a){var d=e(c,a),f=d.join(","),g=function(){var b=null;return b=y.state({component:this.id(),state:a,data:arguments})};f?b.prototype[a]=new Function("body","return function "+a+" ("+f+") { return body.call(this,"+f+") };")(g):b.prototype[a]=new Function("body","return function "+a+" () { return body.call(this) };")(g)})}function m(a,b,c){var d=h(a);d.forEach(function(a){var d=e(c,a),f=d.join(","),g=function(){var b=[],d=-1,e=[],f=0,g=-1,h={};if("RuntimeChannel"===c){if(b=z.RuntimeSystem.find({master:!0}),b.length){for(d=b[0]._id,h.from=d,g=arguments.length,f=0;g>f;f++)e.push(arguments[f]);h.data=e,h.event=a,z.RuntimeMessage.insert(h),y.state({component:this.id(),state:"send",data:[{event:h.event,from:h.from,data:h.data}]})}}else y.state({component:this.id(),state:a,data:arguments})};f?b.prototype[a]=new Function("body","return function "+a+" ("+f+") { return body.call(this,"+f+") };")(g):b.prototype[a]=new Function("body","return function "+a+" () { return body.call(this) };")(g)})}function n(a,b){var c=function(a,c,d){var e="",f="";return y.checkParams({component:this,methodName:"on",args:arguments})&&(A.isValidState(a,b)?A.isEvent(a,b)||A.isProperty(a,b)||A.isLink(a,b)||A.isCollection(a,b)||!(z.RuntimeBehavior.find({component:this.id(),state:a}).length>=1)?E.validParamNumbers(b,a,c)?(e=B.add(this.id(),a,c,d),f=F.get(this.id()),f&&a===f.name&&y.action(e,f.parameters.data)):D.invalidParamNumberMethodOn(this.id(),a):D.behaviorNotUnique(b,a):D.invalidStateOn(b,a)),e};a.prototype.on=new Function("body","return function on (state,handler,useCoreAPI) { return body.call(this,state,handler,useCoreAPI) };")(c)}function o(a,b){var c=function(a,c,d){var e="",f="";return y.checkParams({component:this,methodName:"on",args:arguments})&&(A.isValidState(a,b)?A.isEvent(a,b)||A.isProperty(a,b)||A.isLink(a,b)||A.isCollection(a,b)||!(z.RuntimeBehavior.find({component:this.id(),state:a}).length>=1)?E.validParamNumbers(b,a,c)?(e=B.add(this.id(),a,c,d),f=F.get(this.id()),f&&a===f.name&&y.action(e,f.parameters.data)):D.invalidParamNumberMethodOn(this.id(),a):D.behaviorNotUnique(b,a):D.invalidStateOn(b,a)),e};a.on=new Function("body","return function on (state,handler,useCoreAPI) { return body.call(this, state, handler, useCoreAPI) };")(c)}function p(a,b){var c=function(a,c){y.checkParams({component:this,methodName:"off",args:arguments})&&(A.isValidState(a,b)?B.remove({behaviorId:c,componentId:b,state:a}):D.InvalidStateOff(b,a))};a.off=new Function("body","return function off (state, behaviorId) { return body.call(this, state, behaviorId) };")(c)}function q(a){var b=function(){var a=this.id(),b=[],c=0,d=0;for(z[a]&&(b=z[a].remove()),delete L[a],B.remove({componentId:a}),d=b.length,c=0;d>c;c++)B.remove({componentId:b[c]});y.state({component:a,state:"destroy"})};a.destroy=new Function("body","return function destroy () { return body.call(this) };")(b)}function r(a){var b=function(){return t(this.id()+"Info")};a.classInfo=new Function("body","return function classInfo () { return body.call(this) };")(b)}function s(a){a=a||{};var b={},c="";return c="undefined"==typeof a.model?C.generateId():a.model,b=i(c),L[c]=b,j(b,c),k(a.model,b,c),l(a.model,b,c),m(a.model,b,c),A.inheritFrom(c,"RuntimeComponent")&&(n(b,c),o(b,c),p(b,c),q(b),r(b)),Object.freeze(b),b}function t(a){return L[a]}function u(a){return s(a)}function v(a){var b=L[a],c="";b&&(delete L[a],c=b.constructor.name,z[c].remove({_id:a}),B.remove({componentId:a}),"RuntimeBehavior"===c&&B.removeFromMemory(a))}function w(a){delete L[a]}function x(){L={}}var y=a("./workflow.js"),z=a("./db.js"),A=a("./metamodel.js"),B=a("./behavior.js"),C=a("./helper.js"),D=a("./log.js"),E=a("./workflow.js"),F=a("./state.js"),G="property",H="link",I="collection",J="method",K="event",L={};d.prototype=new Array,c.create=u,c.get=t,c.removeFromMemory=w,c.clear=x,c.destroy=v},{"./behavior.js":2,"./db.js":4,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":9,"./workflow.js":10}],4:[function(a,b,c){"use strict";function d(){var a={},b="",d="",e="",f=null,g=null,h=null,i=null,j=null,k="",l="",m=0,n=0,o="";if(a.schemas={},c.RuntimeSchema.count())for(k in r.RuntimeSchema)h=JSON.parse(JSON.stringify(r.RuntimeSchema[k])),h._core||(a.schemas[k]=h);if(a.models={},c.RuntimeModel.count())for(l in r.RuntimeModel)i=JSON.parse(JSON.stringify(r.RuntimeModel[l])),i._core||(a.models[l]=i);if(a.types={},c.RuntimeType.count())for(e in r.RuntimeType)f=JSON.parse(JSON.stringify(r.RuntimeType[e])),delete f._id,f.core||(a.types[f.name]=f);a.behaviors={};for(d in r.RuntimeBehavior)g=JSON.parse(JSON.stringify(r.RuntimeBehavior[d])),delete g.classInfo,g.core||(a.behaviors[d]=g);for(a.components={},m=s.length,n=0;m>n;n++)if(b=s[n],c[b].count()){j=JSON.parse(JSON.stringify(r[b]));for(o in j)delete j[o].classInfo,j[o]._core&&delete j[o];Object.keys(j).length&&(a.components[b]=j)}return a}function e(a,b){var c=!0,d="";for(d in a){if("undefined"==typeof b[d]){c=!1;break}if(a[d]instanceof RegExp){if(null===b[d].match(a[d])){c=!1;break}}else if(b[d]!==a[d]){c=!1;break}}return c}function f(a){c[a]=new v(a)}function g(a){var b="",e="",f="",g="",h="",i="",j="",k=[],m=null,o=null,p=null,q=null,r={};if(a){for(g in a.types)l.type(a.types[g]);for(h in a.schemas)l.schema(a.schemas[h]);for(i in a.models)l.model(a.models[i]);l.create();for(j in a.behaviors)c.RuntimeBehavior.insert(a.behaviors[j]);for(e in a.components)for(f in a.components[e])c[e].insert(a.components[e][f]);k=c.RuntimeSystem.find({master:!0}),k.length&&(k[0]._id===a._id?a.master=!0:a.master=!1),c.RuntimeSystem.insert(a),b=a._id}else if(k=c.RuntimeSystem.find({master:!0}),k.length){p=k[0],m=p._id,r._id=m,r.name=p.name,r.description=p.description,r.version=p.version,o=d();for(e in o)o.hasOwnProperty(e)&&(r[e]=o[e]);for(j in r.behaviors)q=r.behaviors[j],"main"===q.state&&(q.component=m);b=JSON.stringify(r)}else n.masterSystemNotFound();return b}function h(a){var b={},d=[],e="",f=0,g=0,h=null,i=null,j=null,k=null,l=null,m="";if(d=c.RuntimeSystem.find({master:!0}),d.length&&(e=d[0].name),b.name=a.name||"sub_"+e,b.version=a.version||"0.0.1",b.description=a.description||"",b.subsystem=!0,b.schemas={},a.schemas)for(d=c.RuntimeSchema.find(a.schema),g=d.length,f=0;g>f;f++)h=d[f],h._core||(b.schemas[h._id]=h);if(b.models={},a.models)for(d=c.RuntimeModel.find(a.models),g=d.length,f=0;g>f;f++)j=d[f],j._core||(b.models[j._id]=j);if(b.types={},a.types)for(d=c.RuntimeType.find(a.types),g=d.length,f=0;g>f;f++)i=d[f],i._core||(b.types[i._id]=i);if(b.behaviors={},a.behaviors)for(k=c.RuntimeBehavior.find(a.behaviors),g=d.length,f=0;g>f;f++)k=d[f],k.core||(b.behaviors[k._id]=k);if(b.components={},a.components)for(m in a.components)if(c[m])for(b.components[m]={},d=c[m].find(a.components[m]),g=d.length,f=0;g>f;f++)l=d[f],b.components[m][l._id]=l;return JSON.stringify(b)}function i(){var a=0,b=0,d="";for(a=s.length,b=0;a>b;b++)d=s[b],c[d].remove();for(a=t.length,b=0;a>b;b++)d=t[b],c[d].remove()}function j(){var a="",b=null;b=c.RuntimeSystem.find({_id:"e89c617b6b15d24"})[0],c.clear(),k.clear(),l.clear(),p.clear(),o.clear(),l.init(),a=c.system(b),k.get(a).main()}var k=a("./component.js"),l=a("./metamodel.js"),m=a("./helper.js"),n=a("./log.js"),o=a("./behavior.js"),p=a("./state.js"),q=a("./workflow.js"),r={},s=[],t=["Runtime","RuntimeSchema","RuntimeModel","RuntimeGeneratedModel","RuntimeBehavior","RuntimeState","RuntimeType","RuntimeMetamodel","RuntimeDatabase","RuntimeSystem","RuntimeClassInfo","RuntimeMessage","RuntimeChannel"],u=["RuntimeSchema","RuntimeModel","RuntimeGeneratedModel","RuntimeState","RuntimeType"],v=function(a){l.getSchema(a)||-1!==t.indexOf(a)?(r[a]={},this.name=a,-1===t.indexOf(a)&&s.push(a)):n.invalidCollectionName(a)};v.prototype.find=function(a){var b=[],c="",d={};if(a=a||null,a&&Object.keys(a).length)if(Array.isArray(a))a.forEach(function(a){for(c in r[this.name])d=r[this.name][c],e(a,d)&&b.push(d)}.bind(this));else for(c in r[this.name])d=r[this.name][c],e(a,d)&&b.push(d);else for(c in r[this.name])d=r[this.name][c],b.push(d);return b},v.prototype.insert=function(a){var b=[],d=null,e=[];return Array.isArray(a)?b=a:b.push(a),b.forEach(function(a){var b=null,f=[],g=null,h=[];switch(!0){case"RuntimeSchema"===this.name:case"RuntimeModel"===this.name:case"RuntimeType"===this.name:case"RuntimeGeneratedModel"===this.name:case l.isValidObject(a,l.getModel(this.name)):if("undefined"==typeof a._id&&(a._id=m.generateId()),r[this.name][a._id]=a,d=k.get(this.name),d?(b=new d(a),e.push(b.id())):m.isRuntime()&&m.getRuntime().require("db")&&m.getRuntime().require("db").insert(this.name,a),"RuntimeMessage"===this.name&&m.isRuntime()&&(h=c.RuntimeSystem.find({master:!0}),!h.length||h.length&&h[0]._id!==a.from)){f=c.RuntimeChannel.find({});for(var i=f.length,j=0;i>j;j++)g=m.getRuntime().require(f[j]._id),q.state({component:f[j]._id,state:a.event,data:a.data})}break;default:n.invalidDocumentOnDbInsert(a,this.name)}}.bind(this)),e},v.prototype.update=function(a,b,c){var d=this.find(a),e=0,f=0,g=d.length,h="",i=l.getModel(this.name),j="";if(c=c||{},"undefined"==typeof c.upsert&&(c.upsert=c.upsert||!1),b)for(0===g&&c.upsert&&(a._id&&(b._id=a._id),this.insert(b),e+=1),f=0;g>f;f++){"undefined"!=typeof b._id&&b._id!==d[f]._id&&n.updateUuid(d[f]._id,b._id,"undefined"!=typeof k.get(b._id));for(h in b)"undefined"!=typeof d[f][h]&&("RuntimeSchema"!==this.name&&"RuntimeModel"!==this.name&&"RuntimeGeneratedModel"!==this.name?(j="",0!==h.indexOf("_")?j=i[h].type:l.getMetaDef()[h]&&(j=l.getMetaDef()[h].type),j?l.isValidType(b[h],j)?(d[f][h]=b[h],e+=1,m.isRuntime()&&m.getRuntime().require("db").update(this.name,d[f]._id,h,b[h]),q.state({component:d[f]._id,state:h,data:[b[h]]}),q.state({component:this.name,state:h,data:[b[h]]})):n.invalidPropertyTypeOnDbUpdate(this.name,d[f]._id,h,b[h],i[h]):n.unknownPropertyOnDbUpdate(h,d[f]._id)):(d[f][h]=b[h],e+=1,m.isRuntime()&&m.getRuntime().require("db").update(this.name,d[f]._id,h,b[h])))}return e},v.prototype.remove=function(a){var b=[],c="",d=null,f={};if(a=a||null,a&&Object.keys(a).length)if(Array.isArray(a))a.forEach(function(a){for(c in r[this.name])f=r[this.name][c],e(a,f)&&(delete r[this.name][c],d=k.get(c),d&&d.destroy(),m.isRuntime()&&m.getRuntime().require("db")&&m.getRuntime().require("db").remove(this.name,c),b.push(c))}.bind(this));else for(c in r[this.name])f=r[this.name][c],e(a,f)&&(delete r[this.name][c],d=k.get(c),d&&d.destroy(),m.isRuntime()&&m.getRuntime().require("db")&&m.getRuntime().require("db").remove(this.name,c),b.push(c));else for(c in r[this.name])delete r[this.name][c],-1==u.indexOf(this.name)&&(d=k.get(c),d&&d.destroy()),m.isRuntime()&&m.getRuntime().require("db")&&m.getRuntime().require("db").remove(this.name,c),b.push(c);return b},v.prototype.count=function(){var a=0,b="";for(b in r[this.name])a++;return a},c.collection=f,c.store=r,c.system=g,c.subsystem=h,c.clear=i,c.init=j},{"./behavior.js":2,"./component.js":3,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":9,"./workflow.js":10}],5:[function(a,b,c){"use strict";function d(){var a=!1;return h.Runtime&&h.Runtime.find().length&&(a=!0),a}function e(){var a="";return k||(d()?(a=h.Runtime.find()[0]._id,k=i.get(a)):k={error:function(a){console.error("runtime: "+a.message,a.error)},warning:function(a){console.warn("runtime: "+a)}}),j.getModel("Runtime")||(k={error:function(a){console.error("runtime: "+a.message,a.error)},warning:function(a){console.warn("runtime: "+a)}}),k}function f(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}function g(){void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){var a=/function\s([^(]{1,})\(/,b=a.exec(this.toString());return b&&b.length>1?b[1].trim():""},set:function(a){}})}var h=a("./db.js"),i=a("./component.js"),j=a("./metamodel.js"),k=null;c.getRuntime=e,c.isRuntime=d,c.generateId=f,c.polyfill=g},{"./component.js":3,"./db.js":4,"./metamodel.js":7}],6:[function(a,b,c){"use strict";function d(a,b){var c="";c=b[R]?"unknown property '"+a+"' for the definition of "+b[R]:"unknown property '"+a+"' for the meta attribute "+JSON.stringify(b),Q.getRuntime().warning(c)}function e(a,b,c){Q.getRuntime().warning("invalid type for property '"+JSON.stringify(a)+"': expected type '"+b+"' instead of type '"+typeof c+"'")}function f(a,b){Q.getRuntime().warning("invalid value for the enum value '"+a+"': expected '"+b+"' instead of '"+typeof a+"'")}function g(a,b,c){Q.getRuntime().warning("invalid class name for component '"+a+"': expected '"+b+"' instead of '"+c+"'")}function h(a){Q.getRuntime().warning("missing property '"+a+"'")}function i(a,b){Q.getRuntime().warning("class '"+a+"' is missing for the implementation of the class '"+b+"'")}function j(a,b){Q.getRuntime().warning("invalid type for property '"+a+"' for the definition of '"+b+"'")}function k(a,b){Q.getRuntime().warning("missing property '"+a+"' for the definition of '"+b+"'")}function l(a,b){Q.getRuntime().warning("unknown property '"+a+"' for the definition of '"+b+"'")}function m(a){Q.getRuntime().warning("the type '"+a+"' is not valid")}function n(a,b,c,d){-1!==d.indexOf("#")?Q.getRuntime().warning("invalid name for property '"+b+"': expected '"+d+"' instead of '"+c+"' on component '"+a+"'"):Q.getRuntime().warning("invalid name for property '"+b+"': expected '"+d+"' instead of '"+typeof c+"' on component '"+a+"'")}function o(a,b){Q.getRuntime().warning("can not set read-only property '"+b+"' on component '"+a+"'")}function p(a,b){Q.getRuntime().warning("invalid document '"+JSON.stringify(a)+"' on an insert operation on collection '"+b+"'")}function q(a,b,c,d,e){-1!==e.indexOf("#")?Q.getRuntime().warning("invalid type for property '"+c+"' on an update operation on collection '"+a+"': expected '"+e+"' instead of '"+d+"' on component '"+b+"'"):Q.getRuntime().warning("invalid type for property '"+c+"' on an update operation on collection '"+a+"': expected '"+e+"' instead of '"+typeof d+"' on component '"+b+"'")}function r(a,b){Q.getRuntime().warning("unknown property '"+a+"' on an update operation on component '"+b+"'")}function s(a,b){Q.getRuntime().warning("try to call an unknown method '"+b+"' for the class '"+a+"'")}function t(a){Q.getRuntime().warning("invalid name for creating the collection '"+a+"': there is no schema '"+a+"' in the metamodel")}function u(a,b){Q.getRuntime().warning("invalid type on the result of method '"+b+"' on component '"+a+"'")}function v(a,b){Q.getRuntime().warning("unkown class component '"+a+"' for component '"+b+"'")}function w(){Q.getRuntime().warning("runtime has been restarted")}function x(a,b){Q.getRuntime().warning("invalid number of parameters when calling the method '"+b+"' on component '"+a+"'")}function y(a,b,c){Q.getRuntime().warning("invalid type for the parameter '"+c+"' when calling the method '"+b+"' on component '"+a+"'")}function z(a,b){Q.getRuntime().warning("try to add more than one behavior for the state '"+b+"' on component class '"+a+"'")}function A(a,b){Q.getRuntime().warning("try to add a behavior with an unkwown state '"+b+"' on component class '"+a+"'")}function B(a,b){Q.getRuntime().warning("try to remove a behavior from an unkwown state '"+b+"' on component class '"+a+"'")}function C(){Q.getRuntime().warning("the master system is not found")}function D(a,b){Q.getRuntime().warning("invalid type for value '"+JSON.stringify(a)+"': expected '"+b+"'")}function E(a){Q.getRuntime().warning("unknown type for value '"+JSON.stringify(a)+"'")}function F(a,b){Q.getRuntime().warning("can not yet validate if the component '"+JSON.stringify(a)+"' is an instance of '"+b+"'")}function G(a,b,c){Q.getRuntime().warning("invalid type for the message '"+JSON.stringify(a)+"': expected type '"+c+"' for event '"+b+"'")}function H(a,b){Q.getRuntime().warning("invalid number of parameters when adding an action on method '"+b+"' on component '"+a+"'")}function I(a,b,c){c?Q.getRuntime().warning("try to update a component of id '"+a+"' with the new id '"+b+"' that is already used"):Q.getRuntime().warning("try to update a component of id '"+a+"' with the new id '"+b+"'")}function J(a){Q.getRuntime().warning("try to change the state of the destroyed component '"+a+"'")}function K(a){Q.getRuntime().warning("the schema '"+a+"' is not valid")}function L(a){Q.getRuntime().warning("the model '"+a+"' is not valid")}function M(a){Q.getRuntime().warning("the parameters for creating a component of class '"+a+"' are not compliant with the model")}function N(a,b){Q.getRuntime().warning("trying to get the property '"+a+"' on the destroyed component '"+b+"'")}function O(a,b){Q.getRuntime().warning("the constructor parameter '"+JSON.stringify(a)+"' for creating a component of class '"+b+"' is not an object")}function P(a){Q.getRuntime().warning("try get the information of an unknown model '"+a+"'")}var Q=a("./helper.js"),R="_id";c.unknownProperty=d,c.invalidPropertyType=e,c.invalidEnumValue=f,c.invalidClassName=g,c.missingProperty=h,c.missingImplementation=i,c.invalidTypeImp=j,c.missingPropertyImp=k,c.unknownPropertyImp=l,c.invalidTypeDefinition=m,c.invalidPropertyName=n,c.readOnlyProperty=o,c.invalidDocumentOnDbInsert=p,c.invalidPropertyTypeOnDbUpdate=q,c.unknownMethod=s,c.invalidCollectionName=t,c.invalidResultType=u,c.unknownComponent=v,c.workflowRestarted=w,c.invalidParamNumber=x,c.invalidParamType=y,c.behaviorNotUnique=z,c.invalidStateOn=A,c.invalidStateOff=B,c.masterSystemNotFound=C,c.invalidType=D,c.unknownType=E,c.canNotYetValidate=F,c.invalidChannelEvent=G,c.invalidParamNumberMethodOn=H,c.updateUuid=I,c.unknownPropertyOnDbUpdate=r,c.invalidUseOfComponent=J,c.invalidSchema=K,c.invalidModel=L,c.invalidParameters=M,c.destroyedComponentCall=N,c.invalidConctructorParameters=O,c.unknownModel=P},{"./helper.js":5}],7:[function(a,b,c){"use strict";function d(){var a="",b="",c="",d={},e="",f=null,g=null,h=null,i={},j={},k=[],l=0,m=0;for(c in ma.compiledSchemas){d=ma.compiledSchemas[c],i={_name:d._name,_schema:d._name},"undefined"!=typeof d._core&&(i._core=d._core),Array.isArray(d._inherit)&&(i._inherit=d._inherit),"undefined"!=typeof d._class&&(i._class=d._class);for(a in d)switch(!0){case"property"===d[a]:i[a]={type:"any",readOnly:!1,mandatory:!1,"default":void 0,description:a};break;case"link"===d[a]:i[a]={type:"@RuntimeComponent",readOnly:!1,mandatory:!1,"default":{},description:a};break;case"method"===d[a]:i[a]={params:[{name:"param",type:"any",mandatory:!1}],result:"any",description:a};break;case"event"===d[a]:i[a]={params:[{name:"param",type:"any",mandatory:!1}],description:a};break;case"collection"===d[a]:i[a]={type:["@RuntimeComponent"],readOnly:!1,mandatory:!1,"default":[],description:a}}ma.generatedModels[i._name]=i}for(e in ma.generatedModels)i=ma.generatedModels[e],b=i[aa],g=ma.models[b],g&&(j=z(g,i),delete j._id,ma.generatedModels[b]=j);for(e in ma.generatedModels)for(i=ma.generatedModels[e],k=i[ba],l=Array.isArray(k)?k.length:0,m=0;l>m;m++)b=k[m],f=ma.generatedModels[b],f&&(j=z(f,i),delete j._id,ma.generatedModels[e]=j);for(e in ma.generatedModels)h=ma.generatedModels[e],W.RuntimeGeneratedModel.insert(h)}function e(){var a=[],b=[],c=null,d={},e=[],f=null,g="",h="",i=0,j=0;for(ma.inheritance={},ma.inheritanceTree={},ma.schemas={},ma.compiledSchemas={},ma.models={},ma.generatedModels={},ma.states={},ma.type={},a=W.RuntimeSchema.find({}),j=a.length,i=0;j>i;i++)c=a[i],g=c[aa],h=c[ba],ma.schemas[g]=c,h&&(ma.inheritance[g]=h);for(e=W.RuntimeModel.find({}),j=e.length,i=0;j>i;i++)d=e[i],g=d[aa],ma.models[g]=d;for(b=W.RuntimeType.find({}),j=b.length,i=0;j>i;i++)f=b[i],ma.type[f.name]=f}function f(){function a(a){var b=0,c=0,d=!0;for(c=a.length,b=0;c>b;b++)a[b].length&&(d=!1);return d}function b(a,b){var c=0,d=0,e=[];for(d=b.length,c=0;d>c;c++)0===b[c].indexOf(a)&&(e=b[c],e.reverse(),e.pop(),e.reverse(),b[c]=e)}function c(a,b){var c=!0,d=0,e=0;for(e=b.length,d=0;e>d;d++)b[d].indexOf(a)>0&&(c=!1);return c}function d(a){var d=0,e=0,f=[];for(e=a.length,d=0;e>d;d++)if(c(a[d][0],a)){f.push(a[d][0]),b(a[d][0],a);break}return f}function e(b){var c=[],e=[];for(e=d(b);void 0!==e[0];)c=c.concat(e),e=d(b);return a(b)||Z.stop({error:!1,message:"a cyclic inheritance dependency has been found, please check the '_inherit' properties of your schemas"}),c}function f(a){var b=[],c=ma.inheritance[a].slice();return b=c.length?[a].concat(e(c.map(f).concat([c]))):[a]}var g="",h=[],i=[];for(g in ma.inheritance)h=f(g),i=h.reverse(),i.pop(),i.reverse(),i.length&&(ma.inheritanceTree[g]=i)}function g(a){var b={},c=ma.schemas[a],d=ma.inheritanceTree[a],e=0,f=0,g=null,h="";for(d&&(e=d.length,d.reverse()),f=0;e>f;f++){g=ma.schemas[d[f]];for(h in g)0!==h.indexOf("_")&&(b[h]=g[h])}for(h in c)b[h]=c[h];return b}function h(){var a="";for(a in ma.schemas)ma.compiledSchemas[a]=g(a)}function i(){var a="",b=null,c="";for(a in ma.generatedModels)b=ma.generatedModels[a],b&&"undefined"!=typeof b[ca]&&(c=ma.compiledSchemas[b[ca]],c?k(b,c):X.missingImplementation(b[ca],b[aa]))}function j(){var a="",b=null,c="",d=[],e="";for(a in ma.compiledSchemas){if(d=[],b=ma.compiledSchemas[a],b&&"undefined"==typeof b[ca])for(e in b)c=b[e],0!==e.indexOf("_")&&-1!==ka.indexOf(c)&&d.push(e);ma.states[a]=d}}function k(a,b){var c="",d=null;for(c in b)c!==_&&c!==aa&&c!==ba&&c!==ca&&c!==da&&c!==ea&&("undefined"!=typeof a[c]?(d=a[c],l(d,b[c])||X.invalidTypeImp(c,a[aa])):X.missingPropertyImp(c,a[aa]));for(c in a)c!==_&&c!==aa&&c!==ba&&c!==ca&&c!==da&&c!==ea&&"undefined"==typeof b[c]&&X.unknownPropertyImp(c,a[aa])}function l(a,b){var c=!0;return c=x(b,"string")&&-1!==la.indexOf(b)?x(a,b):m(a,b)}function m(a,b){var c=!0,d=ma.type[b],e=0,f=0;if(x(d,"undefined"))c=!1;else if(x(a,"undefined"))c=!1;else if("array"===d.type)for(e=a.length,f=0;e>f&&(c=x(d.schema,"undefined")?M(a[f],d.type):O(a[f],d.schema),c!==!1);f++);else c=x(d.schema,"undefined")?M(a,d.type):O(a,d.schema);return c}function n(){W.collection("RuntimeSchema"),W.collection("RuntimeModel"),W.collection("RuntimeGeneratedModel"),W.collection("RuntimeClassInfo"),W.collection("RuntimeBehavior"),W.collection("RuntimeState"),W.collection("RuntimeType"),W.collection("RuntimeMessage"),W.collection("RuntimeChannel")}function o(){var a="",b={};for(a in ma.generatedModels)b=ma.generatedModels[a],"undefined"!=typeof b[ca]&&"undefined"==typeof W[b[aa]]&&b[da]!==!1&&W.collection(b[aa])}function p(){var a="",b={};for(a in ma.generatedModels)b=ma.generatedModels[a],"undefined"!=typeof b[ca]&&b[da]!==!1&&Y.create({model:a})}function q(){var a="",b={},c="";for(a in ma.generatedModels)b=ma.generatedModels[a],c=b[aa]+"Info","undefined"!=typeof b[ca]&&b[da]!==!1&&(Y.get(c)?W.RuntimeClassInfo.update({_id:c},{_id:c,metamodel:ma.compiledSchemas[b[ca]],model:b}):W.RuntimeClassInfo.insert({_id:c,metamodel:ma.compiledSchemas[b[ca]],model:b}))}function r(a){return a.replace("@","")}function s(a){var b=x(a,"string")&&-1===la.indexOf(a)&&!t(a);return b}function t(a){return-1!==a.indexOf("@")}function u(a){var b="";return b=Array.isArray(a)?"array":typeof a,"any"===a&&(b="any"),b}function v(a){return a.constructor.name}function w(a,b){return-1!==b.indexOf(a)}function x(a,b){var c=!0;switch(b){case"array":c=Array.isArray(a);break;case"any":c=!0;break;default:c=b===typeof a}return c}function y(a,b,c){var d=!1,e=ma.generatedModels[b],f="";return e&&e[ca]&&(e=ma.compiledSchemas[e[ca]]),e&&(f=e[a],f===c&&(d=!0)),d}function z(a,b,c){var d="",e=b;for(d in a)a.hasOwnProperty(d)&&0!==d.indexOf("_")&&(e[d]=a[d]);return e}function A(a){var b=null,c=[],d=null,e="",f={},g=[];return d=JSON.parse(JSON.stringify(a)),e=d[aa],"undefined"==typeof d[_]&&(d[_]=$.generateId()),"undefined"==typeof d[ba]&&(d[ba]=["RuntimeComponent"]),P(d,ma.metadef.schema,!1)?(g=W.RuntimeSchema.find({_name:e}),g.length?(f=z(d,g[0]),delete f._id,W.RuntimeSchema.update({_name:e},f),b=g[0]._id):(c=W.RuntimeSchema.insert(d),b=c[0])):X.invalidSchema(d[aa]),b}function B(a){var b=null,c=null,d=[],e="",f={},g=[];return b=JSON.parse(JSON.stringify(a)),e=b[aa],"undefined"==typeof b[_]&&(b[_]=$.generateId()),P(b,ma.metadef.model,!1)?(g=W.RuntimeModel.find({_name:e}),g.length?(f=z(b,g[0]),delete f._id,W.RuntimeModel.update({_name:e},f),c=g[0]._id):(d=W.RuntimeModel.insert(b),c=d[0])):X.invalidModel(b[aa]),c}function C(a){var b=null,c=[],d=a.name;return P(a,ma.metadef.type)?(c=W.RuntimeType.insert(a),b=c[0]):X.invalidTypeDefinition(d),b}function D(){E(),ma.metadef={schema:{_id:{type:"string",mandatory:!0},_name:{type:"string",mandatory:!0},_inherit:{type:["string"],mandatory:!1,"default":["RuntimeComponent"]},_schema:{type:"string",mandatory:!1},_class:{type:"boolean",mandatory:!1},_core:{type:"boolean",mandatory:!1}},model:{_id:{type:"string",mandatory:!0},_name:{type:"string",mandatory:!0},_inherit:{type:["string"],mandatory:!1},_schema:{type:"string",mandatory:!1},_class:{type:"boolean",mandatory:!1},_core:{type:"boolean",mandatory:!1}},type:{name:{type:"string",mandatory:!0},type:{type:"string",mandatory:!0},schema:{type:"object",mandatory:!1},value:{type:["string"],mandatory:!1},core:{type:"boolean",mandatory:!1}}},n()}function E(){ma={metadef:{},inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}}}function F(){e(),f(),h(),d(),i(),j(),o(),p(),q()}function G(a,b){return y(a,b,ga)}function H(a,b){return y(a,b,ha)}function I(a,b){return y(a,b,ia)}function J(a,b){return y(a,b,ja)}function K(a,b){return y(a,b,fa)}function L(a,b){var c=!1,d=ma.generatedModels[b],e={};return d&&d[ca]&&(d=ma.generatedModels[d[ca]]),e=ma.states[d[aa]],Array.isArray(e)&&(c=-1!==e.indexOf(a)),c}function M(a,b){function c(a,b){var c=!0,d=r(b),e=a;return x(a,"string")&&(e=Y.get(a)),v(e)!==d&&"{}"!==JSON.stringify(e)&&(c=!1,X.invalidType(a,b.replace("@",""))),c}function d(a,b){var d=!0,e="",f=0,g=0;switch(e=u(b)){case"string":d=x(a,b);break;case"array":for(g=a.length,f=0;g>f;f++)switch(!0){case s(b[0]):d=m(a[f],b[0]);break;case t(b[0]):d=c(a[f],b[0]);break;default:d=x(a[f],b[0])}}return d}var e=!0;if(x(b,"undefined"))X.invalidType(a,b);else switch(!0){case s(b):e=m(a,b);break;case t(b):e=c(a,b);break;default:e=d(a,b)}return e}function N(a,b){function c(a,b){var c=!1,d="";return d=a.constructor.name,"Function"===d&&(d=a.name),c=d===b}var d=!0;return t(b.type)?(d=c(Y.get(a),r(b.type))&&-1!==b.value.indexOf(a),d||X.invalidEnumValue(a,b.type)):(d=x(a,b.type)&&-1!==b.value.indexOf(a),d||X.invalidEnumValue(a,b.type)),d}function O(a,b){function c(){var b=!0,c=[];return j=r(i),j=a[j],s(j)?ma.type[j]?ma.type[j].schema?b=O(f,ma.type[j].schema):(b=x(f,ma.type[j].type),c=ma.type[j].value,c&&(b=w(f,c))):b=!1:b="array"===j?Array.isArray(f):t(j)?x(f,"object")||x(f,"string"):x(f,j),b||X.invalidPropertyType(f,j,f),b}function d(){var a=!0;switch(k=u(i)){case"string":if(s(k))a=O(f,i);else if(!x(f,i)){X.invalidPropertyType(e,i,f),a=!1;break}break;case"array":for(l=f.length,m=0;l>m;m++)if(s(i[0]))a=O(f[m],ma.type[i[0]].schema);else if(!x(f[m],i[0])){X.invalidPropertyType(f[m],i[0],f[m]),a=!1;break}}return a}var e="",f=null,g=!0,h=!0,i="",j="",k="",l=0,m=0;for(e in a){if(f=a[e],x(b[e],"undefined"))return X.unknownProperty(e,b),!1;switch(i=b[e].type,!0){case t(i):g=c();break;default:g=d()}}for(e in b)if(f=b[e],h=f.mandatory,h===!0&&x(a[e],"undefined")&&void 0!==a[e]){X.missingProperty(e),g=!1;break}return g}function P(a,b,c,d){function e(a,b){var c=!0,d="";if(d=ma.type[b])switch(!0){case!x(d.schema,"undefined"):c=P(a,d.schema);break;case!x(d.value,"undefined"):c=N(a,d);break;default:c=M(a,d.type)}else c=!1;return c}function f(b,c){var e=!0,f=null,g=!1;if(m=r(c),b&&b.id?(f=b,g=!0):f=Y.get(b),x(f,"undefined"))switch(!0){case x(b,"object")&&null!==b&&Object.keys(b).length>0:case x(b,"string"):X.canNotYetValidate(b,m)}else V(f.constructor.name,m)?g&&d&&(a[h]=f.id()):(e=!1,X.invalidType(b,m));return e}function g(a,b){var c=!0,e="";switch(n=u(b)){case"any":break;case"string":if(s(n))c=P(a,b);else if("array"===b){if("array"!==u(a)){X.invalidPropertyType(h,b,a),c=!1;break}}else if(u(a)!==b){X.invalidPropertyType(h,b,a),c=!1;break}break;case"array":if(Array.isArray(a)){for(o=a.length,e=b[0],p=0;o>p;p++)if(s(e))c=P(a[p],ma.type[e].schema);else if(t(e))if("string"===u(a[p])){if(v(Y.get(a[p]))!==r(e)){X.invalidClassName(JSON.stringify(a[p]),r(e),v(a[p])),c=!1;break}}else{if(!V(v(a[p]),r(e))){X.invalidClassName(JSON.stringify(a[p]),r(e),v(a[p])),c=!1;break}d&&(a[p]=a[p].id())}else if(u(a[p])!==e){X.invalidPropertyType(a[p],e,a[p]),c=!1;break}}else c=!1,X.invalidType(a,"array");break;default:c=!1,X.unknownType(a)}return c}var h="",i=null,j=!0,k=!0,l="",m="",n="",o=0,p=0;x(c,"undefined")&&(c=!0),x(d,"undefined")&&(c=!1);for(h in a)if(i=a[h],x(b[h],"undefined")&&"_core"!==h){if(c)return X.unknownProperty(h,b),!1}else switch(l="_core"!==h?b[h].type:"boolean","_id"===h&&(l="string"),!0){case s(l):j=e(i,l);break;case t(l):j=f(i,l);break;default:j=g(i,l)}for(h in b)i=b[h],k=i.mandatory,x(a[h],"undefined")&&k===!0&&(X.missingProperty(h),j=!1);return j}function Q(a,b){var c="",d=null,e=!0,f="";for(c in b)d=b[c],e=d.mandatory,f=d["default"],x(a[c],"undefined")&&(e!==!1||x(f,"undefined")||(a[c]=f))}function R(a){var b=null;return ma.compiledSchemas[a]&&(b=ma.compiledSchemas[a]),b}function S(a){var b=null;return ma.generatedModels[a]&&(b=ma.generatedModels[a]),
b}function T(){var a=ma.metadef.schema;return a}function U(a){var b=[],c=null;return c=ma.compiledSchemas[a],c&&(b=c[ba]),b||(b=[]),b}function V(a,b){function c(a,b){var d=!1,e=[],f=0,g=0;if(e=U(a),0!==e.length)if(-1!==e.indexOf(b))d=!0;else for(f=0;g>f&&!(d=c(e[f],b));f++);return d}var d=!1,e=[],f=0,g=0;if(a!==b){if(e=U(a),g=e.length,0!==e.length)if(-1!==e.indexOf(b))d=!0;else for(f=0;g>f&&!(d=c(e[f],b));f++);}else d=!0;return d}var W=a("./db.js"),X=a("./log.js"),Y=a("./component.js"),Z=a("./workflow.js"),$=a("./helper.js"),_="_id",aa="_name",ba="_inherit",ca="_schema",da="_class",ea="_core",fa="method",ga="event",ha="property",ia="link",ja="collection",ka=["property","collection","link","method","event"],la=["boolean","string","number","object","function","array","any"],ma={metadef:{},inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}};c.init=D,c.clear=E,c.schema=A,c.model=B,c.type=C,c.create=F,c.getSchema=R,c.getModel=S,c.getMetaDef=T,c.getParents=U,c.inheritFrom=V,c.isValidObject=P,c.prepareObject=Q,c.isValidType=M,c.isValidEnum=N,c.isValidState=L,c.isEvent=G,c.isProperty=H,c.isLink=I,c.isCollection=J,c.isMethod=K},{"./component.js":3,"./db.js":4,"./helper.js":5,"./log.js":6,"./workflow.js":10}],8:[function(a,b,c){"use strict";var d=a("./db.js"),e=a("./component.js"),f=a("./metamodel.js"),g=a("../build/system/system.js"),h=a("./helper.js"),i="",j="";h.polyfill(),f.init(),i=d.system(g.system),j=e.get(i),j.main(),b.exports=e.get("runtime")},{"../build/system/system.js":1,"./component.js":3,"./db.js":4,"./helper.js":5,"./metamodel.js":7}],9:[function(a,b,c){"use strict";function d(a,b,c){h[a]={name:b,parameters:{data:c}},g.store.RuntimeState[a]={name:b,parameters:{data:c}}}function e(a){return h[a]}function f(){h={}}var g=a("./db.js"),h={};c.set=d,c.get=e,c.clear=f},{"./db.js":4}],10:[function(a,b,c){"use strict";function d(a){this.message=a,this.name="RuntimeError"}function e(a,b){var c=null,d=[],e=[],f=0,g=0;if(s.getModel(a)?c=s.getModel(a)[b]:x.unknownModel(a),c){if(d=c.params)for(f=d.length,g=0;f>g;g++)e.push(d[g].name)}else x.unknownMethod(a,b);return e}function f(a,b){var c=null,d=[],e=[],f=0,g=0,h=0,i=0;if(c=s.getModel(a)[b]){if(d=c.params)for(f=d.length,g=0;f>g;g++)"undefined"!=typeof d[g].mandatory&&d[g].mandatory!==!0||(h+=1),i+=1;e.push(h),e.push(i)}else x.unknownMethod(a,b);return e}function g(a,b,c){var d=null,e=[],f=[],g=0,h=0;if(d=s.getModel(a)[b]){if(e=d.params)for(g=e.length,h=0;g>h;h++)e[h].mandatory===!1&&"undefined"==typeof c[h]?f.push(e[h]["default"]):f.push(c[h])}else x.unknownMethod(a,b);return f}function h(a,b){var c=null,d=null;return c=s.getModel(a)[b].result,c&&(d=c),d}function i(a,b){var c=null,d=[],e=[],f=0,g=0;if(c=s.getModel(a)[b]){if(d=c.params)for(f=d.length,g=0;f>g;g++)e.push(d[g].type)}else x.unknownMethod(a,b);return e}function j(a){a=a||{};var b=a.component||null,c=a.methodName||"",d=a.methodResult||void 0,e="",f=null,g=!0;if(e="Function"===b.constructor.name?b.name:b.constructor.name,f=h(e,c),null!==f)switch(!0){case"any"===f:break;case"array"===f:Array.isArray(d)||(g=!1,x.invalidResultType(b.id(),c));break;default:typeof d!==f&&(g=!1,x.invalidResultType(b.id(),c))}return g}function k(a,b,c){var d=u.getActions(a.id(),b),e=[],f=0,g=0,h=null;if(!d.length||c)if("Function"!==a.constructor.name)d=d.concat(k(t.get(a.constructor.name),b,c));else for(e=s.getParents(a.name),f=e.length,g=0;f>g&&(h=t.get(e[g]),h?d=d.concat(k(h,b,c)):x.unknownComponent(e[g],a.name),!d.length);g++);return d.length&&d.reverse(),d}function l(a,b,e,f,h){var i=null,j=[],k="",l=0,m=0;k="Function"===a.constructor.name?a.name:a.constructor.name,s.isProperty(b,k)||s.isLink(b,k)||s.isCollection(b,k)||(f=g(k,b,f));try{for(m=f.length,l=0;m>l;l++)j.push(f[l]);e.useCoreAPI&&(j.push(t),j.push(y),j.push(s),j.push(c),j.push(u),j.push(v)),h?setTimeout(e.action.bind.apply(e.action,[a].concat(j)),0):i=e.action.apply(a,j)}catch(n){if(n instanceof d)throw n;a&&a.error&&a.error({message:"error when trying to call the method '"+b+"' on component '"+a.id()+"'",error:n}),w.getRuntime()&&w.getRuntime().error({message:"error when trying to call the method '"+b+"' on component '"+a.id()+"'",error:n})}return i}function m(a,b,c){var d="",e=-1,g="",h="",i=[],j=0,k=[],l=!1,m=!1,n=!1,o=!1;switch(d=c.toString(),e=d.indexOf("{"),g=d.substring(0,e),h=g.split("(")[1].replace(")","").trim(),i=h.split(","),""===i[0]&&(i=[]),j=i.length,l=s.isProperty(b,a),m=s.isLink(b,a),n=s.isCollection(b,a),!0){case n:k=[3,3];break;case l:k=[1,1];break;case m:k=[1,1];break;default:k=f(a,b)}return k[0]<=j&&j<=k[1]&&(o=!0),o}function n(a){a=a||{};var b=a.component||null,c=a.methodName||"",d=a.args||"",g=[],h=[],j=[],k="",l=d.length,m=0,n=null,o=!0,p=!1,q=!1,r=!1;switch(k="Function"===b.constructor.name?b.name:b.constructor.name,p=s.isProperty(c,k),q=s.isLink(c,k),r=s.isCollection(c,k),g=e(k,c),!0){case r:h=["number",s.getModel(k)[c].type[0],"string"],j=[3,3];break;case p:h=[s.getModel(k)[c].type],j=[1,1];break;case q:h=[s.getModel(k)[c].type],j=[1,1];break;default:h=i(k,c),j=f(k,c)}for("undefined"==typeof l&&(l=1),-1===j.indexOf(l)&&(o=!1,x.invalidParamNumber(b.id(),c)),m=0;l>m;m++)if(n=d[m],"undefined"==typeof n){if(!(m<j[0]))continue;o=!1,x.invalidParamNumber(b.id(),c)}else s.isValidType(n,h[m])||(o=!1,x.invalidParamType(b.id(),c,g[m]));return o}function o(a,b){var c=!1,d=!1,e=!1,f=!1,g=[],h=null,i=null,j="",k=null;g=y.RuntimeBehavior.find({_id:a}),k=u.get(a),1===g.length&&(h=g[0],i=t.get(h.component),i&&(j="Function"===i.constructor.name?i.name:i.constructor.name,c=s.isEvent(h.state,j),d=s.isProperty(h.state,j),e=s.isLink(h.state,j),f=s.isCollection(h.state,j),(c||d||f||e)&&l(i,h.state,{useCoreAPI:h.useCoreAPI,action:k},b,!0)))}function p(a){a=a||{},a.component=a.component||"",a.state=a.state||"",a.data=a.data||[];var b=null,c="",d=[],e=null,f=null,g=0,h=0,i=!1,m=!1,o=!1,p=!1,q=!1;if(c=v.get(a.component),"destroy"===c&&x.invalidUseOfComponent(a.component),b=t.get(a.component),b&&(i="Function"===b.constructor.name?b.name:b.constructor.name,q=s.isEvent(a.state,i),m=s.isProperty(a.state,i),o=s.isLink(a.state,i),p=s.isCollection(a.state,i),d=k(b,a.state,q)),d.length){if(n({component:b,methodName:a.state,args:a.data}))if(q||m||o||p){for(h=d.length,g=0;h>g;g++)e=d[g],l(b,a.state,e,a.data,!0);v.set(b.id(),a.state,a.data)}else e=d[0],f=l(b,a.state,e,a.data,!1),j({component:b,methodName:a.state,methodResult:f});return f}b&&(q||m||o||p)&&v.set(b.id(),a.state,a.data)}function q(a){if(a=a||{},"undefined"==typeof a.error&&(a.error=!1),a.message=a.message||"",c.state=function(){},a.error)throw new d(a.message?"runtime has been stopped because "+a.message:"runtime has been stopped because of an unknown error");a.message?console.warn("runtime: runtime has been stopped because "+a.message):console.warn("runtime: runtime has been stopped")}function r(){c.state=p,x.workflowRestarted()}var s=a("./metamodel.js"),t=a("./component.js"),u=a("./behavior.js"),v=a("./state.js"),w=a("./helper.js"),x=a("./log.js"),y=a("./db.js");d.prototype=new Error,d.prototype.constructor=d,c.state=p,c.stop=q,c.restart=r,c.checkParams=n,c.validParamNumbers=m,c.action=o},{"./behavior.js":2,"./component.js":3,"./db.js":4,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":9}]},{},[8])(8)});