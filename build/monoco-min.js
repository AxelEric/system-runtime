/* 
 * Monoco
 * A Model and a NoSQL Database for your Components
 * http://monoco.io/
 * @monocojs
 *
 * Copyright (C) 2015 - Erwan Carriou
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.monoco=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d={name:"monoco",version:"0.1.2",description:"A Model and a NoSQL Database for your Components",_id:"e89c617b6b15d24",schemas:{Monoco:{_id:"Monoco",_name:"Monoco",_schema:"MonocoSchema",_inherit:["MonocoComponent"],_core:!0,version:{type:"string",readOnly:!0,mandatory:!0,"default":"0.0.0"},find:{params:[{name:"Class",type:"string"},{name:"query",type:"object",mandatory:!1,"default":{}}],result:"array"},load:{params:[{name:"url",type:"string"},{name:"async",type:"boolean",mandatory:!1,"default":!0}]},warning:{params:[{name:"message",type:"string"}]},system:{params:[{name:"name",type:"string",mandatory:!1}],result:"object"},ready:{}},MonocoBehavior:{_id:"MonocoBehavior",_name:"MonocoBehavior",_schema:"MonocoBehaviorSchema",_core:!0,_class:!1,core:{type:"boolean",readOnly:!1,mandatory:!1,"default":!1},useCoreAPI:{type:"boolean",readOnly:!1,mandatory:!1,"default":!1},component:{type:"string",readOnly:!1,mandatory:!0,"default":""},action:{type:"string",readOnly:!1,mandatory:!0,"default":""},state:{type:"string",readOnly:!1,mandatory:!0,"default":""}},MonocoBehaviorSchema:{_id:"MonocoBehaviorSchema",_name:"MonocoBehaviorSchema",_core:!0,core:"property",component:"property",action:"property",state:"property",useCoreAPI:"property"},MonocoClassInfo:{_id:"MonocoClassInfo",_name:"MonocoClassInfo",_schema:"MonocoClassInfoSchema",_inherit:["MonocoComponent"],_core:!0,metamodel:{type:"object",readOnly:!0,mandatory:!0,"default":{}},model:{type:"object",readOnly:!0,mandatory:!0,"default":{}},property:{params:[{name:"name",type:"string"}],result:"object"},properties:{result:"array"},method:{params:[{name:"name",type:"string"}],result:"object"},methods:{result:"array"},event:{params:[{name:"name",type:"string"}],result:"object"},events:{result:"array"}},MonocoClassInfoSchema:{_id:"MonocoClassInfoSchema",_name:"MonocoClassInfoSchema",_inherit:["MonocoComponentSchema"],_core:!0,model:"property",metamodel:"property",method:"method",methods:"method",property:"method",properties:"method",event:"method",events:"method"},MonocoComponent:{_id:"MonocoComponent",_name:"MonocoComponent",_schema:"MonocoComponentSchema",_core:!0,on:{params:[{name:"state",type:"string"},{name:"handler",type:"function"},{name:"useCoreAPI",type:"boolean",mandatory:!1}]},off:{params:[{name:"state",type:"string"},{name:"behaviorId",type:"string",mandatory:!1}]},require:{params:[{name:"id",type:"string"}]},destroy:{params:[]},classInfo:{type:"@MonocoClassInfo",readOnly:!1,mandatory:!1,"default":{}},init:{params:[{name:"conf",type:"object"}]},error:{params:[{name:"data",type:"errorParam"}]}},MonocoComponentSchema:{_id:"MonocoComponentSchema",_name:"MonocoComponentSchema",_core:!0,on:"method",classInfo:"property",off:"method",require:"method",destroy:"event",init:"event",error:"event"},MonocoDatabase:{_id:"MonocoDatabase",_name:"MonocoDatabase",_schema:"MonocoDatabaseSchema",_inherit:["MonocoComponent"],_core:!0,system:{params:[{name:"system",type:"object",mandatory:!1}],result:"string"},subsystem:{params:[{name:"params",type:"object"}],result:"string"},insert:{params:[{name:"classId",type:"string"},{name:"object",type:"object"}]},update:{params:[{name:"schema",type:"string"},{name:"componentId",type:"string"},{name:"attributeName",type:"string"},{name:"attributeValue",type:"object"}]},remove:{params:[{name:"classId",type:"string"},{name:"object",type:"string"}]}},MonocoDatabaseSchema:{_id:"MonocoDatabaseSchema",_name:"MonocoDatabaseSchema",_inherit:["MonocoComponentSchema"],_core:!0,system:"method",subsystem:"method",insert:"event",update:"event",remove:"event"},MonocoMetamodel:{_id:"MonocoMetamodel",_name:"MonocoMetamodel",_schema:"MonocoMetamodelSchema",_inherit:["MonocoComponent"],_core:!0,schema:{params:[{name:"schema",type:"object"}]},type:{params:[{name:"type",type:"object"}]},create:{params:[]}},MonocoMetamodelSchema:{_id:"MonocoMetamodelSchema",_name:"MonocoMetamodelSchema",_inherit:["MonocoComponentSchema"],_core:!0,schema:"method",type:"method",create:"method"},MonocoSchema:{_id:"MonocoSchema",_name:"MonocoSchema",_inherit:["MonocoComponentSchema"],_core:!0,version:"property",find:"method",load:"method",system:"method",warning:"event",ready:"event"},MonocoState:{_id:"MonocoState",_name:"MonocoState",_schema:"MonocoStateSchema",_class:!1,_core:!0,name:{type:"string",readOnly:!1,mandatory:!0,"default":""}},MonocoStateSchema:{_id:"MonocoStateSchema",_name:"MonocoStateSchema",_core:!0,name:"property"},MonocoSystem:{_id:"MonocoSystem",_name:"MonocoSystem",_schema:"MonocoSystemSchema",_inherit:["MonocoComponent"],_core:!0,name:{type:"string",readOnly:!1,mandatory:!0,"default":""},master:{type:"boolean",readOnly:!1,mandatory:!1,"default":!1},subsystem:{type:"boolean",readOnly:!1,mandatory:!1,"default":!1},version:{type:"string",readOnly:!1,mandatory:!1,"default":"0.0.1"},description:{type:"string",readOnly:!1,mandatory:!1,"default":""},schemas:{type:"object",readOnly:!1,mandatory:!1,"default":{}},behaviors:{type:"object",readOnly:!1,mandatory:!1,"default":{}},types:{type:"object",readOnly:!1,mandatory:!1,"default":{}},components:{type:"object",readOnly:!1,mandatory:!1,"default":{}},ready:{},sync:{},main:{}},MonocoSystemSchema:{_id:"MonocoSystemSchema",_name:"MonocoSystemSchema",_inherit:["MonocoComponentSchema"],_core:!0,name:"property",master:"property",subsystem:"property",version:"property",description:"property",schemas:"property",behaviors:"property",types:"property",components:"property",ready:"event",sync:"method",main:"event"}},types:{collection:{name:"collection",type:"object",schema:{type:{type:["string"],mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},"default":{type:"object",mandatory:!0}},core:!0},errorParam:{name:"errorParam",type:"object",schema:{message:{type:"string",mandatory:!0},error:{type:"object",mandatory:!0}},core:!0},event:{name:"event",type:"object",schema:{params:{type:["parameter"],mandatory:!1}},core:!0},method:{name:"method",type:"object",schema:{result:{type:"string",mandatory:!1},params:{type:["parameter"],mandatory:!1}},core:!0},parameter:{name:"parameter",type:"object",schema:{name:{type:"string",mandatory:!0},type:{type:"string",mandatory:!0},mandatory:{type:"boolean",mandatory:!1},"default":{type:"@type",mandatory:!1}},core:!0},property:{name:"property",type:"object",schema:{type:{type:"string",mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},"default":{type:"@type",mandatory:!0}},core:!0}},behaviors:{"1aaee1e6311ff39":{_id:"1aaee1e6311ff39",component:"monoco",state:"load",action:"function load(url, async) { var xhr = null, callbackLoad = null; xhr = new XMLHttpRequest(); callbackLoad = function callbackLoad(system) { var sysId = $db.system(system); var sys = $component.get(sysId); if (sys) { sys.main(); } }; if (async) { xhr.open('GET', url, true); xhr.onreadystatechange = function () { if (xhr.readyState === 4) { if (xhr.status === 200) { callbackLoad(JSON.parse(xhr.response)); } } }; xhr.send(null); } else { xhr.open('GET', url, false); xhr.send(null); if (xhr.status === 200) { callbackLoad(JSON.parse(xhr.response)); } } }",core:!0,useCoreAPI:!0},"1f6001773a18791":{_id:"1f6001773a18791",component:"monoco",state:"ready",action:"function ready() { var systems = [], system = null, i = 0, length = 0; if (typeof document !== 'undefined') { systems = document.querySelectorAll('link[rel=system]'); length = systems.length; for (i = 0; i < length; i++) { system = systems[i]; this.load(system.href, false); } } }",core:!0},"10b5b160e116285":{_id:"10b5b160e116285",component:"Monoco",state:"error",action:"function error(data) { console.error('monoco: ' + data.message, data.error); }",core:!0},"106bc1a90614f2b":{_id:"106bc1a90614f2b",component:"Monoco",state:"find",action:"function find(Class, query) { var documents = [], components = [], component = null, i = 0, length = 0; if ($db[Class]) { documents = $db[Class].find(query); length = documents.length; for (i = 0; i < length; i++) { component = $component.get(documents[i]._id); if (component) { components.push(component); } } } return components; }",core:!0,useCoreAPI:!0},"1c9931463d15ca1":{_id:"1c9931463d15ca1",component:"Monoco",state:"system",action:"function system(name) { var System = null, system = {}, result = [], conf = {}; if (name) { conf.master = true; conf.name = name; System = monoco.require('MonocoSystem'); system = new System(conf); } else { result = monoco.find('MonocoSystem', {'master': true}); if (result.length) { system = result[0]; } } return system; }",core:!0},"15e0f13b711e533":{_id:"15e0f13b711e533",component:"Monoco",state:"warning",action:"function warning(message) { console.warn('monoco: ' + message); }",core:!0},"10686153ec1f067":{_id:"10686153ec1f067",component:"MonocoClassInfo",state:"event",action:"function event(name) { var result = {}; if (this.metamodel()[name] === 'event') { result = this.model()[name]; } return result; }",core:!0},"15ed512e9911f94":{_id:"15ed512e9911f94",component:"MonocoClassInfo",state:"events",action:"function events() { var keys = Object.keys(this.metamodel()), item = '', result = [], i = 0, length = 0; length = keys.length; for (i = 0; i < length; i++) { item = keys[i]; if (this.metamodel()[item] === 'event') { result.push(item); } } return result; }",core:!0},"139ef1455c19c06":{_id:"139ef1455c19c06",component:"MonocoClassInfo",state:"method",action:"function method(name) { var result = {}; if (this.metamodel()[name] === 'method') { result = this.model()[name]; } return result; }",core:!0},"185791df3417bf3":{_id:"185791df3417bf3",component:"MonocoClassInfo",state:"methods",action:"function methods() { var keys = Object.keys(this.metamodel()), item = '', result = [], i = 0, length = 0; length = keys.length; for (i = 0; i < length; i++) { item = keys[i]; if (this.metamodel()[item] === 'method') { result.push(item); } } return result; }",core:!0},"14ea419bf314db7":{_id:"14ea419bf314db7",component:"MonocoClassInfo",state:"properties",action:"function properties() { var keys = Object.keys(this.metamodel()), item = '', result = [], i = 0, length = 0; length = keys.length; for (i = 0; i < length; i++) { item = keys[i]; if (this.metamodel()[item] === 'property') { result.push(item); } } return result; }",core:!0},"16c6113ea91cd19":{_id:"16c6113ea91cd19",component:"MonocoClassInfo",state:"property",action:"function property(name) { var result = {}; if (this.metamodel()[name] === 'property') { result = this.model()[name]; } return result; }",core:!0},"1d3421682111980":{_id:"1d3421682111980",component:"MonocoComponent",state:"destroy",action:"function destroy() { $component.destroy(this.id()); }",core:!0,useCoreAPI:!0},"1b7c8124fc1566f":{_id:"1b7c8124fc1566f",component:"MonocoComponent",state:"off",action:'function off(state, behaviorId) { var args = [], i = 0, length = 0; length = arguments.length; for (i = 0; i < length - 5; i++) { args.push(arguments[i]); } if ($workflow.checkParams({"component": this, "methodName": "off", "args": args})) { if ($metamodel.isValidState(state, this.constructor.name)) {$behavior.remove({"behaviorId": behaviorId, "componentId": this.id(), "state": state}); } else { $helper.getMonoco().warning("invoke \'off\' method of component \'" + this.id() + "\' with an invalid state \'" + state + "\'"); } } }',core:!0,useCoreAPI:!0},"141861c408189ef":{_id:"141861c408189ef",component:"MonocoComponent",state:"require",action:"function require(id) { return $component.get(id); }",core:!0,useCoreAPI:!0},"1378d1bf221b6ed":{_id:"1378d1bf221b6ed",component:"MonocoDatabase",state:"subsystem",action:"function subsystem(params) { return $db.subsystem(params); }",core:!0,useCoreAPI:!0},"1550718ce61a12a":{_id:"1550718ce61a12a",component:"MonocoDatabase",state:"system",action:"function system(system) { return $db.system(system); }",core:!0,useCoreAPI:!0},"14c5e1e2e31e913":{_id:"14c5e1e2e31e913",component:"MonocoMetamodel",state:"create",action:"function create() { $metamodel.create(); }",core:!0,useCoreAPI:!0},"114761627a1c83f":{_id:"114761627a1c83f",component:"MonocoMetamodel",state:"schema",action:"function schema(schema) { $metamodel.schema(schema); }",core:!0,useCoreAPI:!0},"149431f60011f5e":{_id:"149431f60011f5e",component:"MonocoMetamodel",state:"type",action:"function type(type) { $metamodel.type(type); }",core:!0,useCoreAPI:!0},"1513a182081f000":{_id:"1513a182081f000",component:"MonocoSystem",state:"sync",action:"function sync() { var dump = $db.dump(); this.schemas(dump.schemas); this.types(dump.types); this.behaviors(dump.behaviors); this.components(dump.components); }",core:!0,useCoreAPI:!0},"16c4813de91a3b9":{_id:"16c4813de91a3b9",component:"e89c617b6b15d24",state:"main",action:"function main() { var monoco = $component.get('monoco'); monoco.ready(); }",core:!0,useCoreAPI:!0}},components:{Monoco:{monoco:{_id:"monoco",version:"0.1.2"}},MonocoDatabase:{db:{_id:"db"}},MonocoMetamodel:{metamodel:{_id:"metamodel"}}}};c.system=d},{}],2:[function(a,b,c){"use strict";function d(a,b,c,d){var e="",f=-1,g="",h=[],i=[],j="",k="",l=null;return f=b.indexOf("{"),k=b.substring(0,f),e=k.split("(")[0].replace("function","").trim(),g=k.split("(")[1].replace(")","").trim(),h=g.split(","),h.forEach(function(a){i.push(a.trim())}),j=b.substring(f+1),j=j.substring(0,j.lastIndexOf("}")).trim(),e=e||a,d&&(""===h[0]&&(h=[]),h.push("$component"),h.push("$db"),h.push("$metamodel"),h.push("$workflow"),h.push("$behavior")),l=""!==h[0]?new Function("body","return function "+e+" ("+h.join(",")+") { return new Function('"+h.join("','")+"', body).apply(this, arguments) };")(j):new Function("body","return function "+e+" () { return new Function(body).apply(this, arguments) };")(j)}function e(a,b,c,d){var e=j.generateId();return"undefined"==typeof d&&(d=!1),k[e]=c,i.MonocoBehavior.insert({_id:e,component:a,state:b,action:c.toString(),useCoreAPI:d}),e}function f(a){a=a||{},a.behaviorId=a.behaviorId||"",a.componentId=a.componentId||"",a.state=a.state||"",a.componentId&&i.MonocoBehavior.remove(a.behaviorId?{_id:a.behaviorId,component:a.componentId,state:a.state}:{component:a.componentId,state:a.state})}function g(a,b){var c=[],e=[],f=null;return e=i.MonocoBehavior.find({component:a,state:b}),e.forEach(function(a){f=k[a._id],"undefined"==typeof f&&(f=d(a.state,a.action,a.core,a.useCoreAPI),k[a._id]=f),c.push({core:a.core,action:f})}),c}function h(){k={}}var i=a("./db.js"),j=a("./helper.js"),k={};c.add=e,c.remove=f,c.getActions=g,c.clear=h},{"./db.js":4,"./helper.js":5}],3:[function(a,b,c){"use strict";function d(a){var b=[],c=[],e="",f="";return a=a||{},e=a.classId||"",f=a.type||"",c=a.arr||[],c.forEach(function(a){b.push(-1!==f.indexOf("@")?monoco.require(a):a)}),b.push=function(a){a&&(a.constructor.name===e||A.chekSchema(a,e))&&(this[this.length]=a,c.push(a.id()))},b.pop=function(){var a=null;return c.pop(),a=0!==this.length?this.splice(this.length-1,1):this},b.__proto__=d.prototype,b}function e(a,b){var c=[],d=[],e=0,f=0;if(c=A.get(a)[b].params)for(e=c.length,f=0;e>f;f++)d.push(c[f].name);return d}function f(a){var b=null,c=null,d="",e=0,f=0,g=[];for(b=A.get(a),c=A.get(b._schema),d=Object.keys(c),e=d.length,f=0;e>f;f++)(c[d[f]]===E||c[d[f]]===F)&&g.push({name:d[f],type:b[d[f]].type,readOnly:b[d[f]].readOnly});return g}function g(a){var b=null,c=null,d="",e=0,f=0,g=[];for(b=A.get(a),c=A.get(b._schema),d=Object.keys(c),e=d.length,f=0;e>f;f++)c[d[f]]===G&&g.push(d[f]);return g}function h(a){var b=null,c=null,d="",e=0,f=0,g=[];for(b=A.get(a),c=A.get(b._schema),d=Object.keys(c),e=d.length,f=0;e>f;f++)c[d[f]]===H&&g.push(d[f]);return g}function i(a,b){var c=function(a){a=a||{};var c={};A.isValidObject(a,A.get(b),!0,!0)?A.prepareObject(a,A.get(b)):y.stop({error:!0,message:"the parameters for creating a component of class '"+b+"' are not compliant with the model"}),"undefined"==typeof a._id&&(a._id=C.generateId()),I[a._id]=this,c=function(){return a._id},this.id=new Function("body","return function id () { return body.call(this) };")(c),a.classInfo=b+"Info",z.store[b][a._id]=a,C.isMonoco()&&C.getMonoco().require("db")&&C.getMonoco().require("db").insert(b,a),Object.freeze(this),this.init&&this.init(a)};return new Function("body","return function "+b+" (config) { body.call(this,config) };")(c)}function j(a,b){var c=function(){return b};a.id=new Function("body","return function id (prop, val) { return body.call(this, prop, val) };")(c)}function k(a,b,c){var e=f(a);e.forEach(function(a){var e={},f="",g="",h="";f=a.name,g=a.type,h=a.readOnly,Array.isArray(g)?(e=function(a,b){var e=[],i=null,j=null,k=null;if("undefined"==typeof b){if("undefined"==typeof a)return j=new d({classId:c,type:g[0],arr:z.store[c][this.id()][f]});if(k=z.store[c][this.id()][f][a])return monoco.require(k)}else h?D.readOnlyProperty(this.id(),f):A.isValidType(b,g)&&(e=z[c].find({_id:this.id()}),e.length?(i=e[0],i[f][0]=b.id(),C.isMonoco()&&C.getMonoco().require("db").update(c,this.id(),f,b.id()),y.state({component:this.id(),state:f,data:arguments})):D.invalidPropertyName(this.id(),f,b,g))},b.prototype[f]=new Function("body","return function "+f+" (position, value) { return body.call(this, position, value) };")(e)):(e=function(a){var b=[],d=null,e=null;if("undefined"==typeof a){if(d=z.store[c][this.id()])return e=d[f],-1!==g.indexOf("@")&&(e=t(e)),e;y.stop({error:!0,message:"trying to get the property '"+f+"' on the destroyed component '"+this.id()+"'"})}else h?D.readOnlyProperty(this.id(),f):A.isValidType(a,g)?(b=z[c].find({_id:this.id()}),b.length&&(d=b[0],d[f]=-1!==g.indexOf("@")?a.id():a,C.isMonoco()&&C.getMonoco().require("db")&&C.getMonoco().require("db").update(c,this.id(),f,a),y.state({component:this.id(),state:f,data:arguments}))):D.invalidPropertyName(this.id(),f,a,g)},b.prototype[f]=new Function("body","return function "+f+" (value) { return body.call(this,value) };")(e))})}function l(a,b,c){var d=g(a);d.forEach(function(a){var d=e(c,a),f=d.join(","),g=function(){var b=null;return b=y.state({component:this.id(),state:a,data:arguments})};b.prototype[a]=f?new Function("body","return function "+a+" ("+f+") { return body.call(this,"+f+") };")(g):new Function("body","return function "+a+" () { return body.call(this) };")(g)})}function m(a,b,c){var d=h(a);d.forEach(function(a){var d=e(c,a),f=d.join(","),g=function(){y.state({component:this.id(),state:a,data:arguments})};b.prototype[a]=f?new Function("body","return function "+a+" ("+f+") { return body.call(this,"+f+") };")(g):new Function("body","return function "+a+" () { return body.call(this) };")(g)})}function n(a,b){var c=function(a,c,d){var e="";return y.checkParams({component:this,methodName:"on",args:arguments})&&(A.isValidState(a,b)?!A.isEvent(a,b)&&z.MonocoBehavior.find({component:this.id(),state:a}).length>=1?D.behaviorNotUnique(b,a):e=B.add(this.id(),a,c,d):D.invalidStateOn(b,a)),e};a.prototype.on=new Function("body","return function on (state,handler,useCoreAPI) { return body.call(this,state,handler,useCoreAPI) };")(c)}function o(a,b){var c=function(a,c,d){var e="";return y.checkParams({component:this,methodName:"on",args:arguments})&&(A.isValidState(a,b)?!A.isEvent(a,b)&&z.MonocoBehavior.find({component:this.id(),state:a}).length>=1?D.behaviorNotUnique(b,a):e=B.add(this.id(),a,c,d):D.invalidStateOn(b,a)),e};a.on=new Function("body","return function on (state,handler,useCoreAPI) { return body.call(this, state, handler, useCoreAPI) };")(c)}function p(a,b){var c=function(a,c){y.checkParams({component:this,methodName:"off",args:arguments})&&(A.isValidState(a,b)?B.remove({behaviorId:c,componentId:b,state:a}):D.InvalidStateOff(b,a))};a.off=new Function("body","return function off (state, behaviorId) { return body.call(this, state, behaviorId) };")(c)}function q(a){var b=function(){var a=this.id();z[a]&&z[a].remove(),delete I[a],y.state({component:a,state:"destroy"})};a.destroy=new Function("body","return function destroy () { return body.call(this) };")(b)}function r(a){var b=function(){return t(this.id()+"Info")};a.classInfo=new Function("body","return function classInfo () { return body.call(this) };")(b)}function s(a){a=a||{};var b={},c="";return c="undefined"==typeof a.model?C.generateId():a.model,b=i(a,c),I[c]=b,j(b,c),k(a.model,b,c),l(a.model,b,c),m(a.model,b,c),A.inheritFrom(c,"MonocoComponent")&&(n(b,c),o(b,c),p(b,c),q(b),r(b)),Object.freeze(b),b}function t(a){return I[a]}function u(a){return s(a)}function v(a,b){var c=!1,d="";return d=a.constructor.name,"Function"===d&&(d=a.name),c=a===b}function w(a){var b=I[a],c="";b&&(delete I[a],c=b.constructor.name,z[c].remove({_id:a}))}function x(){I={}}var y=a("./workflow.js"),z=a("./db.js"),A=a("./metamodel.js"),B=a("./behavior.js"),C=a("./helper.js"),D=a("./log.js"),E="property",F="collection",G="method",H="event",I={};d.prototype=new Array,c.create=u,c.get=t,c.isInstanceOf=v,c.clear=x,c.destroy=w},{"./behavior.js":2,"./db.js":4,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./workflow.js":10}],4:[function(a,b,c){"use strict";function d(a,b){var c=!0,d={};for(d in a)if("undefined"==typeof b[d]||b[d]!==a[d]){c=!1;break}return c}function e(a){c[a]=new p(a)}function f(){var a={},b="",d="",e="",f=null,g=null,h=null,i="",j=0,k=0;if(a.schemas={},c.MonocoSchema.count())for(i in m.MonocoSchema)h=m.MonocoSchema[i],h._core||(a.schemas[i]=h);if(a.types={},c.MonocoType.count())for(e in m.MonocoType)f=JSON.parse(JSON.stringify(m.MonocoType[e])),delete f._id,f.core||(a.types[f.name]=f);a.behaviors={};for(d in m.MonocoBehavior)g=JSON.parse(JSON.stringify(m.MonocoBehavior[d])),g.core||(a.behaviors[d]=g);for(a.components={},j=n.length,k=0;j>k;k++)b=n[k],c[b].count()&&(a.components[b]=m[b]);return a}function g(a){var b="",d="",e="",g="",h="",i="",k=[],m=null,n=null,o=null,p={};if(a){for(g in a.types)j.type(a.types[g]);for(h in a.schemas)j.schema(a.schemas[h]);j.create();for(i in a.behaviors)c.MonocoBehavior.insert(a.behaviors[i]);for(d in a.components)for(e in a.components[d])c[d].insert(a.components[d][e]);k=c.MonocoSystem.find({master:!0}),a.master=k.length&&k[0]._id===a._id?!0:!1,c.MonocoSystem.insert(a),b=a._id}else if(p=f(),k=c.MonocoSystem.find({master:!0}),k.length){n=k[0],m=n._id;for(i in p.behaviors)o=p.behaviors[i],"main"===o.state&&(o.component=m);p.name=n.name,p.version=n.version,p.description=n.description,p._id=m,b=JSON.stringify(p)}else l.masterSystemNotFound();return b}function h(a){var b={},d=[],e="",f=0,g=0,h=null,i=null,j=null,k=null,l="";if(d=monoco.find("MonocoSystem",{master:!0}),d.length&&(e=d[0].name()),b.name=a.name||"sub_"+e,b.version=a.version||"0.0.1",b.description=a.description||"",b.subsystem=!0,b.schemas={},a.schemas)for(d=c.MonocoSchema.find(a.schema),g=d.length,f=0;g>f;f++)h=d[f],h._core||(b.schemas[h._id]=h);if(b.types={},a.types)for(d=c.MonocoType.find(a.types),g=d.length,f=0;g>f;f++)i=d[f],i._core||(b.types[i._id]=i);if(b.behaviors={},a.behaviors)for(j=c.MonocoBehavior.find(a.behaviors),g=d.length,f=0;g>f;f++)j=d[f],j.core||(b.behaviors[j._id]=j);if(b.components={},a.components)for(l in a.components)if(c[l])for(b.components[l]={},d=c[l].find(a.components[l]),g=d.length,f=0;g>f;f++)k=d[f],b.components[l][k._id]=k;return JSON.stringify(b)}var i=a("./component.js"),j=(a("./state.js"),a("./behavior.js"),a("./metamodel.js")),k=a("./helper.js"),l=a("./log.js"),m={},n=[],o=["Monoco","MonocoSchema","MonocoExtendedSchema","MonocoBehavior","MonocoState","MonocoType","MonocoMetamodel","MonocoDatabase","MonocoSystem","MonocoClassInfo"],p=function(a){j.get(a)||-1!==o.indexOf(a)?(m[a]={},this.name=a,-1===o.indexOf(a)&&n.push(a)):l.invalidCollectionName(a)};p.prototype.find=function(a){var b=[],c="",e={};if(a=a||null,a&&Object.keys(a).length)for(c in m[this.name])e=m[this.name][c],d(a,e)&&b.push(e);else for(c in m[this.name])e=m[this.name][c],b.push(e);return b},p.prototype.insert=function(a){var b=[],c=null,d=[];return Array.isArray(a)?b=a:b.push(a),b.forEach(function(a){var b=null;"MonocoSchema"===this.name||"MonocoType"===this.name||"MonocoExtendedSchema"===this.name||j.isValidObject(a,j.get(this.name))?("undefined"==typeof a._id&&(a._id=k.generateId()),m[this.name][a._id]=a,c=i.get(this.name),c&&(b=new c(a),d.push(b.id())),k.isMonoco()&&k.getMonoco().require("db")&&k.getMonoco().require("db").insert(this.name,a)):l.invalidDocumentOnDbInsert(a,this.name)}.bind(this)),d},p.prototype.update=function(a,b,c){var d=this.find(a),e=0,f=0,g=d.length,h="",i=j.get(this.name);if(c=c||{},"undefined"==typeof c.upsert&&(c.upsert=c.upsert||!1),b)for(0===g&&c.upsert&&(a._id&&(b._id=a._id),this.insert(b),e+=1),f=0;g>f;f++)for(h in b)"undefined"!=typeof d[f][h]&&(i[h]&&i[h].type&&j.isValidType(b[h],i[h].type)?(d[f][h]=b[h],e+=1,k.isMonoco()&&k.getMonoco().require("db").update(this.name,d[f]._id,h,b[h])):l.invalidPropertyTypeOnDbUpdate(this.name,d[f]._id,h,b[h],i[h]));return e},p.prototype.remove=function(a){var b=0,c="",e=null,f={};if(a=a||null,a&&Object.keys(a).length)for(c in m[this.name])f=m[this.name][c],d(a,f)&&(delete m[this.name][c],e=i.get(c),e&&e.destroy(),k.isMonoco()&&k.getMonoco().require("db").remove(this.name,c),b++);else for(c in m[this.name])delete m[this.name][c],e=i.get(c),e&&e.destroy(),k.isMonoco()&&k.getMonoco().require("db")&&k.getMonoco().require("db").remove(this.name,c),b++;return b},p.prototype.count=function(){var a=0,b="";for(b in m[this.name])a++;return a},c.collection=e,c.store=m,c.dump=f,c.system=g,c.subsystem=h},{"./behavior.js":2,"./component.js":3,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":9}],5:[function(a,b,c){"use strict";function d(){var a=!1;return g.Monoco&&g.Monoco.find().length&&(a=!0),a}function e(){var a="";return i||(d()?(a=g.Monoco.find()[0]._id,i=h.get(a)):i={error:function(a,b){console.error("monoco: "+a,b)},warning:function(a){console.warn("monoco: "+a)}}),i}function f(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}return a()+a()+a()}var g=a("./db.js"),h=a("./component.js"),i=(a("./workflow.js"),null);c.getMonoco=e,c.isMonoco=d,c.generateId=f},{"./component.js":3,"./db.js":4,"./workflow.js":10}],6:[function(a,b,c){"use strict";function d(a,b){var c="";c=b[H]?"unknown property '"+a+"' for the definition of "+b[H]:"unknown property '"+a+"' for the meta attribute "+JSON.stringify(b),G.getMonoco().warning(c)}function e(a,b,c){G.getMonoco().warning("invalid type for property '"+JSON.stringify(a)+"': expected '"+b+"' instead of '"+typeof c+"'")}function f(a,b){G.getMonoco().warning("invalid value for the enum value '"+a+"': expected '"+b+"' instead of "+typeof a+"'")}function g(a,b,c){G.getMonoco().warning("invalid class name for component '"+a+"': expected '"+b+"' instead of '"+c+"'")}function h(a){G.getMonoco().warning("missing property '"+a+"'")}function i(a,b){G.getMonoco().warning("class '"+a+"' is missing for the implementation of the class '"+b+"'")}function j(a,b){G.getMonoco().warning("invalid type for property '"+a+"' for the definition of '"+b+"'")}function k(a,b){G.getMonoco().warning("missing property '"+a+"' for the definition of '"+b+"'")}function l(a,b){G.getMonoco().warning("unknown property '"+a+"' for the definition of '"+b[H]+"'")}function m(a){G.getMonoco().warning("can not load the type definition "+a)}function n(a,b,c,d){G.getMonoco().warning(-1!==d.indexOf("#")?"invalid name for property '"+b+"': expected '"+d+"' instead of '"+c+"' on component '"+a+"'":"invalid name for property '"+b+"': expected '"+d+"' instead of '"+typeof c+"' on component '"+a+"'")}function o(a,b){G.getMonoco().warning("can not set read-only property "+b+" on component '"+a+"'")}function p(a,b){G.getMonoco().warning("invalid document "+JSON.stringify(a)+" on an insert operation on collection "+b)}function q(a,b,c,d,e){G.getMonoco().warning(-1!==e.indexOf("#")?"invalid type for property '"+c+"' on an update operation on collection "+a+": expected '"+e+"' instead of '"+d+"' on component '"+b+"'":"invalid type for property '"+c+"' on an update operation on collection "+a+": expected '"+e+"' instead of '"+typeof d+"' on component '"+b+"'")}function r(a,b){G.getMonoco().warning("try to call an unknown method '"+b+"' for the class '"+a+"'")}function s(a){G.getMonoco().warning("invalid name for creating the collection '"+a+"': there is no schema '"+a+"' in the metamodel")}function t(a,b){G.getMonoco().warning("invalid type on the result of method '"+b+"' on component '"+a+"'")}function u(a,b){G.getMonoco().warning("unkown class component '"+a+"' for component '"+b+"'")}function v(){G.getMonoco().warning("monoco has been restarted")}function w(a,b){G.getMonoco().warning("invalid number of parameters when calling the method '"+b+"' on component '"+a+"'")}function x(a,b,c){G.getMonoco().warning("invalid type for the parameter '"+c+"' when calling the method '"+b+"' on component '"+a+"'")}function y(a,b){G.getMonoco().warning("try to add more than one behavior for the state '"+b+"' on component class '"+a+"'")}function z(a,b){G.getMonoco().warning("try to add a behavior with an unkwown state '"+b+"' on component class '"+a+"'")}function A(a,b){G.getMonoco().warning("try to remove a behavior from an unkwown state '"+b+"' on component class '"+a+"'")}function B(){G.getMonoco().warning("the master system is not found")}function C(a,b){G.getMonoco().warning("invalid type for value '"+JSON.stringify(a)+"': expected '"+b+"'")}function D(a){G.getMonoco().warning("unknown type for value '"+JSON.stringify(a)+"'")}function E(a,b){G.getMonoco().warning("can not yet validate if the component '"+JSON.stringify(a)+"' is an instance of '"+b+"'")}function F(a){G.getMonoco().warning("can not call a method on component '"+a+"': the component has been destroyed")}var G=a("./helper.js"),H="_id";c.unknownProperty=d,c.invalidPropertyType=e,c.invalidEnumValue=f,c.invalidClassName=g,c.missingProperty=h,c.missingImplementation=i,c.invalidTypeImp=j,c.missingPropertyImp=k,c.unknownPropertyImp=l,c.invalidTypeDefinition=m,c.invalidPropertyName=n,c.readOnlyProperty=o,c.invalidDocumentOnDbInsert=p,c.invalidPropertyTypeOnDbUpdate=q,c.unknownMethod=r,c.invalidCollectionName=s,c.invalidResultType=t,c.unknownComponent=u,c.workflowRestarted=v,c.invalidParamNumber=w,c.invalidParamType=x,c.behaviorNotUnique=y,c.invalidStateOn=z,c.invalidStateOff=A,c.masterSystemNotFound=B,c.invalidType=C,c.unknownType=D,c.canNotYetValidate=E,c.componentDestroyed=F},{"./helper.js":5}],7:[function(a,b,c){"use strict";function d(){var a=null,b=null,c=null;for(a in Y.inheritance)for(b=Y.inheritance[a],Y.inheritanceTree[a]=[];b;)Y.inheritanceTree[a].push(b),c=b,b=Y.inheritance[c]}function e(a){var b={},c=Y.catalog[a],d=Y.inheritanceTree[a],e=0,f=0,g=null,h="";for(d&&(e=d.length,d.reverse()),f=0;e>f;f++){g=Y.catalog[d[f]];for(h in g)0!==h.indexOf("_")&&(b[h]=g[h])}for(h in c)b[h]=c[h];return b}function f(){var a="";for(a in Y.catalog)Y.model[a]=e(a)}function g(){var a="",b=null,c="";for(a in Y.model)b=Y.model[a],b&&"undefined"!=typeof b[S]&&(c=Y.model[b[S]],c?(i(b,c),Y.implementation[b[P]]=c[P]):M.missingImplementation(b[S],b[P]))}function h(){var a="",b=null,c="",d=[],e="";for(a in Y.model){if(d=[],b=Y.model[a],b&&"undefined"==typeof b[S])for(e in b)c=b[e],0!==e.indexOf("_")&&-1!==W.indexOf(c)&&d.push(e);Y.states[a]=d}}function i(a,b){var c="",d=null;for(c in b)c!==P&&c!==Q&&c!==R&&c!==S&&c!==T&&c!==U&&("undefined"!=typeof a[c]?(d=a[c],j(d,b[c])||M.invalidTypeImp(c,a[P])):M.missingPropertyImp(c,a[P]));
for(c in a)c!==P&&c!==Q&&c!==R&&c!==S&&c!==T&&c!==U&&"undefined"==typeof b[c]&&M.unknownPropertyImp(c,a[P])}function j(a,b){var c=!0;return c=v(b,"string")&&-1!==X.indexOf(b)?v(a,b):k(a,b)}function k(a,b){var c=!0,d=Y.type[b],e=0,f=0;if(v(d,"undefined"))c=!1;else if(v(a,"undefined"))c=!1;else if("array"===d.type)for(e=a.length,f=0;e>f&&(c=F(a[f],d.schema),c!==!1);f++);else c=F(a,d.schema);return c}function l(){L.collection("MonocoSchema"),L.collection("MonocoExtendedSchema"),L.collection("MonocoClassInfo"),L.collection("MonocoBehavior"),L.collection("MonocoState"),L.collection("MonocoType")}function m(){var a="",b={},c="";for(a in Y.catalog)b=Y.catalog[a],L.MonocoSchema.insert(b),"undefined"!=typeof b[S]&&"undefined"==typeof L[b[P]]&&b[T]!==!1&&L.collection(b[P]);for(a in Y.model)b=Y.model[a],L.MonocoExtendedSchema.insert(b);for(c in Y.type)b=Y.type[c],b._id=b.name,L.MonocoType.insert(b)}function n(){var a="",b={};for(a in Y.model)b=Y.model[a],"undefined"!=typeof b[S]&&b[T]!==!1&&N.create({model:a})}function o(){var a="",b={};for(a in Y.model)b=Y.model[a],"undefined"!=typeof b[S]&&b[T]!==!1&&L.MonocoClassInfo.insert({_id:b._id+"Info",metamodel:Y.model[b[S]],model:b})}function p(a){return a.replace("@","")}function q(a){var b=v(a,"string")&&-1===X.indexOf(a)&&!r(a);return b}function r(a){return-1!==a.indexOf("@")}function s(a){var b="";return b=Array.isArray(a)?"array":typeof a}function t(a){return a.constructor.name}function u(a,b){return-1!==b.indexOf(a)}function v(a,b){var c=!0;switch(b){case"array":c=Array.isArray(a);break;default:c=b===typeof a}return c}function w(a){var b=a[P],c=a[R],d=a[Q],e=0,f=0;if(v(b,"undefined")&&(b=d,a[P]=d),G(a,Y.metadef.schema,!1)){if(Y.catalog[b]=a,c)for(e=c.length,f=0;e>f;f++)Y.inheritance[b]=c[f]}else O.stop({error:!0,message:"the schema '"+JSON.stringify(a)+"' is not valid"})}function x(a){var b=a.name;G(a,Y.metadef.type)?b?Y.type[b]=a:M.invalidTypeDefinition(a):O.stop({error:!0,message:"the type '"+JSON.stringify(a)+"' is not valid"})}function y(){z(),Y.metadef={schema:{_id:{type:"string",mandatory:!0},_name:{type:"string",mandatory:!0},_inherit:{type:["string"],mandatory:!1},_schema:{type:"string",mandatory:!1},_class:{type:"boolean",mandatory:!1},_core:{type:"boolean",mandatory:!1}},type:{name:{type:"string",mandatory:!0},type:{type:"string",mandatory:!0},schema:{type:"object",mandatory:!1},value:{type:["string"],mandatory:!1},core:{type:"boolean",mandatory:!1}}},l()}function z(){Y={catalog:{},inheritance:{},inheritanceTree:{},model:{},states:{},type:{},implementation:{}}}function A(){d(),f(),g(),h(),m(),n(),o()}function B(a,b){var c=!1,d=Y.model[b],e="";return d&&d[S]&&(d=Y.model[d[S]]),d&&(e=d[a],e===V&&(c=!0)),c}function C(a,b){var c=!1,d=Y.model[b],e={};return d&&d[S]&&(d=Y.model[d[S]]),e=Y.states[d[P]],Array.isArray(e)&&(c=-1!==e.indexOf(a)),c}function D(a,b){function c(a,b){var c=!0,d=p(b);return t(a)!==d&&(c=!1,M.invalidType(a.id(),b)),c}var d=!0;if(v(b,"undefined"))M.invalidType(a,b);else switch(!0){case q(b):d=k(a,b);break;case r(b):d=c(a,b);break;default:d=v(a,b)}return d}function E(a,b){var c=!0;return r(b.type)?(c=N.isInstanceOf(N.get(a),p(b.type))&&-1!==b.value.indexOf(a),c||M.invalidEnumValue(a,b.type)):(c=v(a,b.type)&&-1!==b.value.indexOf(a),c||M.invalidEnumValue(a,b.type)),c}function F(a,b){function c(){var b=!0,c=[];return j=p(i),j=a[j],q(j)?Y.type[j]?Y.type[j].schema?b=F(f,Y.type[j].schema):(b=v(f,Y.type[j].type),c=Y.type[j].value,c&&(b=u(f,c))):b=!1:b="array"===j?Array.isArray(f):r(j)?v(f,"object"):v(f,j),b||M.invalidPropertyType(f,j,f),b}function d(){var a=!0;switch(k=s(i)){case"string":if(q(k))a=F(f,i);else if(!v(f,i)){M.invalidPropertyType(e,i,f),a=!1;break}break;case"array":for(l=f.length,m=0;l>m;m++)if(q(i[0]))a=F(f[m],Y.type[i[0]].schema);else if(!v(f[m],i[0])){M.invalidPropertyType(f[m],i[0],f[m]),a=!1;break}}return a}var e="",f=null,g=!0,h=!0,i="",j="",k="",l=0,m=0;for(e in a){if(f=a[e],v(b[e],"undefined"))return M.unknownProperty(e,b),!1;switch(i=b[e].type,!0){case r(i):g=c();break;default:g=d()}}for(e in b)if(f=b[e],h=f.mandatory,h===!0&&v(a[e],"undefined")){M.missingProperty(e),g=!1;break}return g}function G(a,b,c,d){function e(){var a=!0;return l=Y.type[l],a=l?l.schema?G(i,l.schema):E(i,l):!1}function f(){var b=!0,c=null,e=!1;if(m=p(l),i&&i.id?(c=i,e=!0):c=N.get(i),v(c,"undefined"))switch(!0){case v(i,"object")&&null!==i&&Object.keys(i).length:case v(i,"string"):M.canNotYetValidate(i,m)}else t(c)!==m?(b=!1,M.invalidType(i,m)):e&&d&&(a[h]=c.id());return b}function g(){var a=!0,b="";switch(n=s(l)){case"string":if(q(n))a=G(i,l);else if("array"===l){if("array"!==s(i)){M.invalidPropertyType(h,l,i),a=!1;break}}else if(s(i)!==l){M.invalidPropertyType(h,l,i),a=!1;break}break;case"array":if(Array.isArray(i)){for(o=i.length,b=l[0],u=0;o>u;u++)if(q(b))a=G(i[u],Y.type[b].schema);else if(r(b))if("string"===s(i[u])){if(t(N.get(i[u]))!==p(b)){M.invalidClassName(JSON.stringify(i[u]),p(b),t(i[u])),a=!1;break}}else{if(t(i[u])!==p(b)){M.invalidClassName(JSON.stringify(i[u]),p(b),t(i[u])),a=!1;break}d&&(i[u]=i[u].id())}else if(s(i[u])!==b){M.invalidPropertyType(i[u],b,i[u]),a=!1;break}}else a=!1,M.invalidType(i,"array");break;default:a=!1,M.unknownType(i)}return a}var h="",i=null,j=!0,k=!0,l="",m="",n="",o=0,u=0;v(c,"undefined")&&(c=!0),v(d,"undefined")&&(c=!1);for(h in a)if(i=a[h],v(b[h],"undefined")){if(c)return M.unknownProperty(h,b),!1}else switch(l=b[h].type,"_id"===h&&(l="string"),!0){case q(l):j=e();break;case r(l):j=f();break;default:j=g()}for(h in b)i=b[h],k=i.mandatory,v(a[h],"undefined")&&k===!0&&(M.missingProperty(h),j=!1);return j}function H(a,b){var c="",d=null,e=!0,f="";for(c in b)d=b[c],e=d.mandatory,f=d["default"],v(a[c],"undefined")&&(e!==!1||v(f,"undefined")||(a[c]=f))}function I(a){var b=null;return Y.model[a]&&(b=Y.model[a]),b}function J(a){var b=[],c=null;return c=Y.model[a],c&&(b=c[R]),b||(b=[]),b}function K(a,b){function c(a,b){var d=!1,e=[],f=0,g=0;if(e=J(a),0!==e.length)if(1!==e.indexOf(b))d=!0;else for(f=0;g>f&&!(d=c(e[f],b));f++);return d}var d=!1,e=[],f=0,g=0;if(e=J(a),0!==e.length)if(1!==e.indexOf(b))d=!0;else for(f=0;g>f&&!(d=c(e[f],b));f++);return d}var L=a("./db.js"),M=a("./log.js"),N=a("./component.js"),O=a("./workflow.js"),P="_id",Q="_name",R="_inherit",S="_schema",T="_class",U="_core",V="event",W=["property","collection","method","event"],X=["boolean","string","number","object","function","array"],Y={metadef:{},catalog:{},inheritance:{},inheritanceTree:{},model:{},states:{},type:{},implementation:{}};c.init=y,c.clear=z,c.schema=w,c.type=x,c.create=A,c.get=I,c.getParents=J,c.inheritFrom=K,c.isValidObject=G,c.prepareObject=H,c.isValidType=D,c.isValidEnum=E,c.isValidState=C,c.isEvent=B},{"./component.js":3,"./db.js":4,"./log.js":6,"./workflow.js":10}],8:[function(a,b){"use strict";var c=a("./db.js"),d=a("./component.js"),e=a("./metamodel.js"),f=a("../build/system/system.js"),g="",h="";e.init(),g=c.system(f.system),h=d.get(g),h.main(),b.exports=d.get("monoco")},{"../build/system/system.js":1,"./component.js":3,"./db.js":4,"./metamodel.js":7}],9:[function(a,b,c){"use strict";function d(a,b){h[a]=b,g.store.MonocoState[a]={name:b}}function e(a){return h[a]}function f(){h={}}var g=a("./db.js"),h={};c.set=d,c.get=e,c.clear=f},{"./db.js":4}],10:[function(a,b,c){"use strict";function d(a){this.message=a,this.name="MonocoError"}function e(a,b){var c=null,d=[],e=[],f=0,g=0;if(c=q.get(a)[b]){if(d=c.params)for(f=d.length,g=0;f>g;g++)e.push(d[g].name)}else v.unknownMethod(a,b);return e}function f(a,b){var c=null,d=[],e=[],f=0,g=0,h=0,i=0;if(c=q.get(a)[b]){if(d=c.params)for(f=d.length,g=0;f>g;g++)("undefined"==typeof d[g].mandatory||d[g].mandatory===!0)&&(h+=1),i+=1;e.push(h),e.push(i)}else v.unknownMethod(a,b);return e}function g(a,b,c){var d=null,e=[],f=[],g=0,h=0;if(d=q.get(a)[b]){if(e=d.params)for(g=e.length,h=0;g>h;h++)f.push(e[h].mandatory===!1&&"undefined"==typeof c[h]?e[h]["default"]:c[h])}else v.unknownMethod(a,b);return f}function h(a,b){var c=null,d=null;return c=q.get(a)[b].result,c&&(d=c),d}function i(a,b){var c=null,d=[],e=[],f=0,g=0;if(c=q.get(a)[b]){if(d=c.params)for(f=d.length,g=0;f>g;g++)e.push(d[g].type)}else v.unknownMethod(a,b);return e}function j(a){a=a||{};var b=a.component||null,c=a.methodName||"",d=a.methodResult||void 0,e="",f=null,g=!0;return e="Function"===b.constructor.name?b.name:b.constructor.name,f=h(e,c),null!==f&&("array"===f?Array.isArray(d)||(g=!1,v.invalidResultType(b.id(),c)):typeof d!==f&&(g=!1,v.invalidResultType(b.id(),c))),g}function k(a,b,c){var d=s.getActions(a.id(),b),e=[],f=0,g=0,h=null;if(!d.length||c)if("Function"!==a.constructor.name)d=d.concat(k(r.get(a.constructor.name),b,c));else for(e=q.getParents(a.name),f=e.length,g=0;f>g&&(h=r.get(e[g]),h?d=d.concat(k(h,b,c)):v.unknownComponent(e[g],a.name),!d.length);g++);return d.length&&d.reverse(),d}function l(a,b,e,f){var h=null,i=[],j=0,k=0;f=g(a.constructor.name,b,f);try{if(e.core){for(k=f.length,j=0;k>j;j++)i.push(f[j]);i.push(r),i.push(w),i.push(q),i.push(c),i.push(s),h=e.action.apply(a,i)}else h=e.action.apply(a,f)}catch(l){if(l instanceof d)throw l;a&&a.error&&a.error({message:"error when trying to call the method '"+b+"' on component '"+a.id()+"'",error:l}),u.getMonoco()&&u.getMonoco().error({message:"error when when trying to call the method '"+b+"' on component '"+a.id()+"'",error:l})}return h}function m(a){a=a||{};var b=a.component||null,c=a.methodName||"",d=a.args||"",g=[],h=[],j=[],k="",l=d.length,m=0,n=null,o=!0;for(k="Function"===b.constructor.name?b.name:b.constructor.name,g=e(k,c),h=i(k,c),j=f(k,c),"undefined"==typeof l&&(l=1),-1===j.indexOf(l)&&(o=!1,v.invalidParamNumber(b.id(),c)),m=0;l>m;m++)if(n=d[m],"undefined"==typeof n){if(!(m<j[0]))continue;o=!1,v.invalidParamNumber(b.id(),c)}else q.isValidType(n,h[m])||(o=!1,v.invalidParamType(b.id(),c,g[m]));return o}function n(a){a=a||{},a.component=a.component||"",a.state=a.state||"",a.data=a.data||[];var b=null,d="",e=[],f=null,g=null,h=0,i=0,n=!1;if(d=t.get(a.component),"destroy"!==d){if(b=r.get(a.component),b&&(n=q.isEvent(a.state,b.constructor.name),e=k(b,a.state,n)),e.length){if(m({component:b,methodName:a.state,args:a.data}))if(n){for(i=e.length,h=0;i>h;h++)f=e[h],l(b,a.state,f,a.data);t.set(b.id(),a.state)}else f=e[0],g=l(b,a.state,f,a.data),j({component:b,methodName:a.state,methodResult:g})&&t.set(b.id(),a.state);return g}b&&t.set(b.id(),a.state)}else c.stop({error:!0,message:"trying to change the state of a destroyed component '"+a.component+"'"})}function o(a){if(a=a||{},"undefined"==typeof a.error&&(a.error=!1),a.message=a.message||"",c.state=function(){},a.error)throw new d(a.message?"monoco has been stopped because "+a.message:"monoco has been stopped because of an unknown error");console.warn("monoco: monoco has been stopped")}function p(){c.state=n,v.workflowRestarted()}var q=a("./metamodel.js"),r=a("./component.js"),s=a("./behavior.js"),t=a("./state.js"),u=a("./helper.js"),v=a("./log.js"),w=a("./db.js");d.prototype=new Error,d.prototype.constructor=d,c.state=n,c.stop=o,c.restart=p,c.checkParams=m},{"./behavior.js":2,"./component.js":3,"./db.js":4,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":9}]},{},[8])(8)});